if(typeof Prototype=='undefined'||!Prototype.Version.match("1.6"))
throw("Prototype-UI library require Prototype library >= 1.6.0");(function(p){var b=p.Browser,n=navigator;if(b.WebKit){b.WebKitVersion=parseFloat(n.userAgent.match(/AppleWebKit\/([\d\.\+]*)/)[1]);b.Safari2=(b.WebKitVersion<420);}
if(b.IE){b.IEVersion=parseFloat(n.appVersion.split(';')[1].strip().split(' ')[1]);b.IE6=b.IEVersion==6;b.IE7=b.IEVersion==7;}
p.falseFunction=function(){return false};p.trueFunction=function(){return true};})(Prototype);if (typeof UI == "undefined") {var UI = {Abstract: { },Ajax: { }};}Object.extend(Class.Methods,{extend:Object.extend.methodize(),addMethods:Class.Methods.addMethods.wrap(function(proceed,source){if(!source)return this;if(!source.hasOwnProperty('methodsAdded'))
return proceed(source);var callback=source.methodsAdded;delete source.methodsAdded;proceed(source);callback.call(source,this);source.methodsAdded=callback;return this;}),addMethod:function(name,lambda){var methods={};methods[name]=lambda;return this.addMethods(methods);},method:function(name){return this.prototype[name].valueOf();},classMethod:function(){$A(arguments).flatten().each(function(method){this[method]=(function(){return this[method].apply(this,arguments);}).bind(this.prototype);},this);return this;},undefMethod:function(name){this.prototype[name]=undefined;return this;},removeMethod:function(name){delete this.prototype[name];return this;},aliasMethod:function(newName,name){this.prototype[newName]=this.prototype[name];return this;},aliasMethodChain:function(target,feature){feature=feature.camelcase();this.aliasMethod(target+"Without"+feature,target);this.aliasMethod(target,target+"With"+feature);return this;}});Object.extend(Number.prototype,{snap:function(round){return parseInt(round==1?this:(this/round).floor()*round);}});Object.extend(String.prototype,{camelcase:function(){var string=this.dasherize().camelize();return string.charAt(0).toUpperCase()+string.slice(1);},makeElement:function(){var wrapper=new Element('div');wrapper.innerHTML=this;return wrapper.down();}});Object.extend(Array.prototype,{isEmpty:function(){return!this.length;},at:function(index){return this[index<0?this.length+index:index];},removeAt:function(index){if(-index>this.length)return;return this.splice(index,1)[0];},removeIf:function(iterator,context){for(var i=this.length-1,objects=[];i>=0;i--)
if(iterator.call(context,this[i],i))
objects.push(this.removeAt(i));return objects.reverse();},remove:function(object){return this.removeIf(function(member){return member===object}).length;},insert:function(index){if(index>this.length)
this.length=index;else if(index<0)
index=this.length+index+1;this.splice.apply(this,[index,0].concat($A(arguments).slice(1)));return this;}});Array.prototype.empty=Array.prototype.isEmpty;Element.addMethods({getScrollDimensions:function(element){element=$(element);return{width:element.scrollWidth,height:element.scrollHeight}},getScrollOffset:function(element){element=$(element);return Element._returnOffset(element.scrollLeft,element.scrollTop);},setScrollOffset:function(element,offset){element=$(element);if(arguments.length==3)
offset={left:offset,top:arguments[2]};element.scrollLeft=offset.left;element.scrollTop=offset.top;return element;},getNumStyle:function(element,style){var value=parseFloat($(element).getStyle(style));return isNaN(value)?null:value;},appendText:function(element,text){element=$(element);element.appendChild(document.createTextNode(String.interpret(text)));return element;}});document.whenReady=(function(){var queue=[];document.observe('dom:loaded',function(){queue.invoke('call',document);queue.clear();document.whenReady=function(callback){callback.bind(document).defer()};});return function(callback){queue.push(callback)};})();Object.extend(document.viewport,{getScrollOffset:document.viewport.getScrollOffsets,setScrollOffset:function(offset){Element.setScrollOffset(Prototype.Browser.WebKit?document.body:document.documentElement,offset);},getScrollDimensions:function(){return Element.getScrollDimensions(Prototype.Browser.WebKit?document.body:document.documentElement);}});document.whenReady(function(){window.$head=$(document.getElementsByTagName('head')[0]);window.$body=$(document.body);});(function(){UI.Options={methodsAdded:function(klass){klass.classMethod($w(' setOptions allOptions optionsGetter optionsSetter optionsAccessor '));},setOptions:function(options){if(!this.hasOwnProperty('options'))
this.options=this.allOptions();this.options=Object.extend(this.options,options||{});},allOptions:function(){var superclass=this.constructor.superclass,ancestor=superclass&&superclass.prototype;return(ancestor&&ancestor.allOptions)?Object.extend(ancestor.allOptions(),this.options):Object.clone(this.options);},optionsGetter:function(){addOptionsAccessors(this,arguments,false);},optionsSetter:function(){addOptionsAccessors(this,arguments,true);},optionsAccessor:function(){this.optionsGetter.apply(this,arguments);this.optionsSetter.apply(this,arguments);}};function addOptionsAccessors(receiver,names,areSetters){names=$A(names).flatten();if(names.empty())
names=Object.keys(receiver.allOptions());names.each(function(name){var accessorName=(areSetters?'set':'get')+name.camelcase();receiver[accessorName]=receiver[accessorName]||(areSetters?function(value){return this.options[name]=value}:function(){return this.options[name]});});}})();var CSS=(function(){function fixPNG(){parseStylesheet.apply(this,$A(arguments).concat(fixRule));};function parseStylesheet(){var patterns=$A(arguments);var method=patterns.pop();var styleSheets=$A(document.styleSheets);if(patterns.length>0){styleSheets=styleSheets.select(function(css){return patterns.any(function(pattern){return css.href&&css.href.match(pattern)});});}
styleSheets.each(function(styleSheet){fixStylesheet.call(this,styleSheet,method)});};function fixStylesheet(stylesheet,method){if(stylesheet.imports)
$A(stylesheet.imports).each(fixStylesheet);var href=stylesheet.href||document.location.href;var docPath=href.substr(0,href.lastIndexOf('/'));$A(stylesheet.rules||stylesheet.cssRules).each(function(rule){method.call(this,rule,docPath)});};var filterPattern='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="#{src}",sizingMethod="#{method}")';function fixRule(rule,docPath){var bgImg=rule.style.backgroundImage;if(bgImg&&bgImg!='none'&&bgImg.match(/^url[("']+(.*\.png)[)"']+$/i)){var src=RegExp.$1;var bgRepeat=rule.style.backgroundRepeat;if(src[0]!='/')
src=docPath+"/"+src;rule.style.filter=filterPattern.interpolate({src:src,method:bgRepeat=="no-repeat"?"crop":"scale"});rule.style.backgroundImage="none";}};var preloadedImages=new Hash();function preloadRule(rule,docPath){var bgImg=rule.style.backgroundImage;if(bgImg&&bgImg!='none'&&bgImg!='initial'){if(!preloadedImages.get(bgImg)){bgImg.match(/^url[("']+(.*)[)"']+$/i);var src=RegExp.$1;if(!(src[0]=='/'||src.match(/^file:/)||src.match(/^https?:/)))
src=docPath+"/"+src;preloadedImages.set(bgImg,true);var image=new Image();image.src=src;}}}
return{fixPNG:(Prototype.Browser.IE&&Prototype.Browser.IEVersion<7)?fixPNG:Prototype.emptyFunction,addRule:function(css){var style=new Element('style',{type:'text/css',media:'screen'});$head.insert(style);if(style.styleSheet)style.styleSheet.cssText=css;else style.appendText(css);return style;},preloadImages:function(){parseStylesheet.apply(this,$A(arguments).concat(preloadRule));}};})();Object.extend(Date.prototype,{addDays:function(days){return new Date(this.getFullYear(),this.getMonth(),this.getDate()+days,this.getHours(),this.getMinutes(),this.getSeconds(),this.getMilliseconds());},succ:function(){return this.addDays(1);},firstOfMonth:function(){return new Date(this.getFullYear(),this.getMonth(),1);},endOfMonth:function(){return new Date(this.getFullYear(),this.getMonth()+1,0);},getDayOfYear:function(){return Math.ceil((this-new Date(this.getFullYear(),0,1))/86400000);},strftime:function(grammar){var parts={},i18n=Date.default_i18n;var lambda=function(date,part){switch(part){case'a':return i18n.WEEKDAYS_MEDIUM[date.getDay()];case'A':return i18n.WEEKDAYS[date.getDay()];case'b':case'h':return i18n.MONTHS_SHORT[date.getMonth()];case'B':return i18n.MONTHS[date.getMonth()];case'C':return Math.floor(date.getFullYear()/100);case'd':return date.getDate().toPaddedString(2);case'e':return date.getDate();case'j':return date.getDayOfYear();case'm':return(date.getMonth()+1).toPaddedString(2);case'u':return date.getDay()||7;case'w':return date.getDay();case'y':return date.getFullYear().toString().substring(2);case'Y':return date.getFullYear();case'H':return date.getHours().toPaddedString(2);case'I':return(date.getHours()%12).toPaddedString(2);case'M':return date.getMinutes().toPaddedString(2);case'p':return date.getHours()<12?'am':'pm';case'S':return date.getSeconds().toPaddedString(2);case'n':return'\n';case't':return'\t';case'D':return date.strftime('%m/%d/%y');case'r':return date.strftime('%I:%M:%S %p');case'R':return date.strftime('%H:%M:%S');case'T':return date.strftime('%H:%M:%S');case'c':return date.strftime(i18n.FORMAT_DATETIME);case'x':return date.strftime(i18n.FORMAT_DATE);case'X':return date.strftime(i18n.FORMAT_TIME);}};grammar.scan(/\w+/,function(e){var part=e.first();parts[part]=lambda(this,part);}.bind(this));return grammar.interpolate(parts,Date.STRFT_GRAMMER);},equalsDate:function(other){return(this.getMonth()==other.getMonth()&&this.getDate()==other.getDate()&&this.getFullYear()==other.getFullYear());}});Object.extend(Date,{STRFT_GRAMMER:/(^|.|\r|\n)(\%(\w+))/,default_i18n:{MONTHS_SHORT:$w('Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec'),MONTHS:$w('January February March April May June July August September October November December'),WEEKDAYS_MEDIUM:$w('Sun Mon Tue Wed Thu Fri Sat'),WEEKDAYS:$w('Sunday Monday Tuesday Wednesday Thursday Friday Saturday'),FORMAT_DATE:'%m/%d/%Y',FORMAT_TIME:'%H:%M:%S',FORMAT_DATETIME:'%x %X'},parseString:function(dateString,format){var date=new Date(),i18n=Date.default_i18n;format=format.replace('%D','%m/%d/%y');format=format.replace('%T','%H:%M:%S').replace('%r','%I:%M:%S %p').replace('%R','%H:%M:%S');format=format.replace('%c',i18n.FORMAT_DATETIME).replace('%x',i18n.FORMAT_DATE).replace('%X',i18n.FORMAT_TIME);var tokens=format.match(/%./g);dateString.split(/[^A-Za-z0-9\u00A1-\uFFFF]+/).each(function(e,i){switch(tokens[i]){case'%a':case'%A':case'%u':case'%w':break;case'%b':case'%h':date.setMonth(i18n.MONTHS_SHORT.indexOf(e));break;case'%B':date.setMonth(i18n.MONTHS.indexOf(e));break;case'%C':break;case'%d':case'%e':date.setDate(parseInt(e,10));break;case'%j':break;case'%m':date.setMonth(parseInt(e,10)-1);break;case'%w':date.setDay(parseInt(e,10));break;case'%y':var year=parseInt(e,10);if(year<50)year+=2000;if(year<100)year+=1900;date.setYear(year);break;case'%Y':date.setFullYear(parseInt(e,10));break;case'%H':date.setHours(parseInt(e,10));break;case'%I':date.setHours(parseInt(e,10));break;case'%M':date.setMinutes(parseInt(e,10));break;case'%p':if(e=='pm')date.setHours(date.getHours()+12);break;case'%S':date.setSeconds(parseInt(e,10));break;}});return date;}});UI.Benchmark={benchmark:function(lambda,iterations){var date=new Date();(iterations||1).times(lambda);return(new Date()-date)/1000;}};Element.addMethods({enableDrag:function(element){return $(element).writeAttribute('draggable');},disableDrag:function(element){return $(element).writeAttribute('draggable',null);},isDraggable:function(element){return $(element).hasAttribute('draggable');}});(function(){var initPointer,draggedElement;document.observe('mousedown',function(event){if(draggedElement=findDraggable(event.element())){event.preventDefault();initPointer=event.pointer();document.observe('mousemove',startDrag);document.observe('mouseup',cancelDrag);}});function findDraggable(element){while(element&&element!==document){if(element.hasAttribute('draggable'))return element;element=$(element.parentNode);}};function startDrag(event){document.stopObserving('mousemove',startDrag).stopObserving('mouseup',cancelDrag).observe('mousemove',drag).observe('mouseup',endDrag);fire('drag:started',event);};function cancelDrag(event){document.stopObserving('mousemove',startDrag).stopObserving('mouseup',cancelDrag);};function drag(event){fire('drag:updated',event);};function endDrag(event){document.stopObserving('mousemove',drag).stopObserving('mouseup',endDrag);fire('drag:ended',event);};function fire(eventName,event){var pointer=event.pointer();draggedElement.fire(eventName,{dx:pointer.x-initPointer.x,dy:pointer.y-initPointer.y,mouseEvent:event});};})();UI.State=(function(browser){var watch,change,changed,fragment;function getFragment(){var fragment=top.location.hash;return fragment&&fragment!='#'?fragment.substr(1):null;}
function fragmentChanged(newFragment){fragment=newFragment;if(fragment&&fragment.include('state:'))
document.fire('state:changed',{name:fragment.sub('state:','')});else if(!fragment&&changed)
document.fire('state:changed',{name:'initial'});}
document.whenReady(function(){fragmentChanged(getFragment());if(browser.IE){var iframe=new Element('iframe',{style:'display: none'});$body.insert(iframe);var contentWindow=iframe.contentWindow;function writeToIFrame(html){var doc=contentWindow.document;doc.open();doc.write(html);doc.close();}
function readFromIFrame(){return contentWindow.document.body.innerText;}
writeToIFrame(fragment||'');watch=function(){var newFragment=readFromIFrame();if(newFragment!==fragment){top.location.hash=newFragment;fragmentChanged(newFragment);}};change=function(fragment){writeToIFrame(fragment);};}else if(browser.WebKit){var counter=history.length,fragments=[];change=function(fragment){top.location.hash=fragment;fragments[history.length]=fragment;};watch=function(){var newFragment=getFragment(),newCounter=history.length;if(newFragment!==fragment)fragmentChanged(newFragment);else if(newCounter!=counter){fragmentChanged(fragments[newCounter-1]);fragment=newFragment;}
counter=newCounter;};}else{watch=function(){var newFragment=getFragment();if(newFragment!==fragment)fragmentChanged(newFragment);};change=function(fragment){top.location.hash=fragment;};}
setInterval(function(){if(changed)watch()},50);});return{change:function(name){change('state:'+name);changed=true;},isSupported:function(){return!browser.Opera;}}})(Prototype.Browser);UI.IframeShim=Class.create(UI.Options,{initialize:function(){this.element=new Element('iframe',{style:'position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);display:none',src:'javascript:false;',frameborder:0});$(document.body).insert(this.element);},hide:function(){this.element.hide();return this;},show:function(){this.element.show();return this;},positionUnder:function(element){var element=$(element),offset=element.cumulativeOffset(),dimensions=element.getDimensions(),style={left:offset[0]+'px',top:offset[1]+'px',width:dimensions.width+'px',height:dimensions.height+'px',zIndex:element.getStyle('zIndex')-1};this.element.setStyle(style).show();return this;},setBounds:function(bounds){for(prop in bounds){bounds[prop]+='px';}
this.element.setStyle(bounds);return this;},setSize:function(width,height){this.element.style.width=parseInt(width)+"px";this.element.style.height=parseInt(height)+"px";return this;},setPosition:function(top,left){this.element.style.top=parseInt(top)+"px";this.element.style.left=parseInt(left)+"px";return this;},destroy:function(){if(this.element)
this.element.remove();return this;}});UI.Abstract.Logger=Class.create({level:'debug'});(function(){var levels=$w(" debug info warn error ");levels.each(function(level,index){UI.Abstract.Logger.addMethod(level,function(message){if(index>=levels.indexOf(this.level))
this._log({level:level,message:message,date:new Date()});});});})();UI.NullLogger=Class.create(UI.Abstract.Logger,{_log:Prototype.emptyFunction});UI.MemLogger=Class.create(UI.Abstract.Logger,{initialize:function(){this.logs=[];},_log:function(log){this.logs.push(log);}});UI.ConsoleLogger=Class.create(UI.Abstract.Logger,{_log:function(log){console[log.level](log.message);}});UI.ElementLogger=Class.create(UI.Abstract.Logger,{initialize:function(element){this.element=$(element);},format:'<p>(<span class="date">#{date}</span>) '+'<span class="level">#{level}</span> : '+'<span class="message">#{message}</span></p>',_log:function(log){var entry=this.format.interpolate({level:log.level.toUpperCase(),message:log.message.escapeHTML(),date:log.date.toLocaleTimeString()});this.element.insert({top:entry});}});document.whenReady(function(){if($('log'))UI.logger=new UI.ElementLogger('log');else if(window.console)UI.logger=new UI.ConsoleLogger();else UI.logger=new UI.MemLogger();});UI.Shadow=Class.create(UI.Options,{options:{theme:"mac_shadow",focus:false,zIndex:100},initialize:function(element,options){this.setOptions(options);this.element=$(element);this.create();this.iframe=Prototype.Browser.IE?new UI.IframeShim():null;if(Object.isElement(this.element.parentNode))
this.render();},destroy:function(){if(this.shadow.parentNode)
this.remove();},setPosition:function(top,left){if(this.shadowSize){var shadowStyle=this.shadow.style;top=parseInt(top)-this.shadowSize.top+this.shadowShift.top;left=parseInt(left)-this.shadowSize.left+this.shadowShift.left;shadowStyle.top=top+'px';shadowStyle.left=left+'px';if(this.iframe)
this.iframe.setPosition(top,left);}
return this;},setSize:function(width,height){if(this.shadowSize){try{var w=Math.max(0,parseInt(width)+this.shadowSize.width-this.shadowShift.width)+"px";this.shadow.style.width=w;var h=Math.max(0,parseInt(height)-this.shadowShift.height)+"px";this.shadowContents[1].childElements().each(function(e){e.style.height=h});this.shadowContents.each(function(item){item.style.width=w});if(this.iframe)
this.iframe.setSize(width+this.shadowSize.width-this.shadowShift.width,height+this.shadowSize.height-this.shadowShift.height);}
catch(e){}}
return this;},setBounds:function(bounds){return this.setPosition(bounds.top,bounds.left).setSize(bounds.width,bounds.height);},setZIndex:function(zIndex){this.shadow.style.zIndex=zIndex;return this;},show:function(){this.render();this.shadow.show();if(this.iframe)
this.iframe.show();return this;},hide:function(){this.shadow.hide();if(this.iframe)
this.iframe.hide();return this;},remove:function(){this.shadow.remove();return this;},focus:function(){this.options.focus=true;this.updateShadow();return this;},blur:function(){this.options.focus=false;this.updateShadow();return this;},render:function(){if(this.element.parentNode&&!Object.isElement(this.shadow.parentNode)){this.element.parentNode.appendChild(this.shadow);this.computeSize();this.setBounds(Object.extend(this.element.getDimensions(),this.getElementPosition()));this.shadow.show();}
return this;},create:function(){var zIndex=this.element.getStyle('zIndex');if(!zIndex)
this.element.setStyle({zIndex:this.options.zIndex});zIndex=(zIndex||this.options.zIndex)-1;this.shadowContents=new Array(3);this.shadowContents[0]=new Element("div").insert(new Element("div",{className:"shadow_center_wrapper"}).insert(new Element("div",{className:"n_shadow"}))).insert(new Element("div",{className:"shadow_right ne_shadow"})).insert(new Element("div",{className:"shadow_left nw_shadow"}));this.shadowContents[1]=new Element("div").insert(new Element("div",{className:"shadow_center_wrapper c_shadow"})).insert(new Element("div",{className:"shadow_right e_shadow"})).insert(new Element("div",{className:"shadow_left w_shadow"}));this.centerElements=this.shadowContents[1].childElements();this.shadowContents[2]=new Element("div").insert(new Element("div",{className:"shadow_center_wrapper"}).insert(new Element("div",{className:"s_shadow"}))).insert(new Element("div",{className:"shadow_right se_shadow"})).insert(new Element("div",{className:"shadow_left sw_shadow"}));this.shadow=new Element("div",{className:"shadow_container "+this.options.theme,style:"position:absolute; top:-10000px; left:-10000px; display:none; z-index:"+zIndex}).insert(this.shadowContents[0]).insert(this.shadowContents[1]).insert(this.shadowContents[2]);},computeSize:function(){if(this.focusedShadowShift)
return;this.shadow.show();var content=this.shadowContents[1].select("div.c_shadow").first();this.unfocusedShadowShift={};this.focusedShadowShift={};$w("top left bottom right").each(function(pos){this.unfocusedShadowShift[pos]=content.getNumStyle("padding-"+pos)||0}.bind(this));this.unfocusedShadowShift.width=this.unfocusedShadowShift.left+this.unfocusedShadowShift.right;this.unfocusedShadowShift.height=this.unfocusedShadowShift.top+this.unfocusedShadowShift.bottom;$w("top left bottom right").each(function(pos){this.focusedShadowShift[pos]=content.getNumStyle("margin-"+pos)||0}.bind(this));this.focusedShadowShift.width=this.focusedShadowShift.left+this.focusedShadowShift.right;this.focusedShadowShift.height=this.focusedShadowShift.top+this.focusedShadowShift.bottom;this.shadowShift=this.options.focus?this.focusedShadowShift:this.unfocusedShadowShift;this.shadowSize={top:this.shadowContents[0].childElements()[1].getNumStyle("height"),left:this.shadowContents[0].childElements()[1].getNumStyle("width"),bottom:this.shadowContents[2].childElements()[1].getNumStyle("height"),right:this.shadowContents[0].childElements()[2].getNumStyle("width")};this.shadowSize.width=this.shadowSize.left+this.shadowSize.right;this.shadowSize.height=this.shadowSize.top+this.shadowSize.bottom;content.setStyle("padding:0; margin:0");this.shadow.hide();},updateShadow:function(){this.shadowShift=this.options.focus?this.focusedShadowShift:this.unfocusedShadowShift;var shadowStyle=this.shadow.style,pos=this.getElementPosition(),size=this.element.getDimensions();shadowStyle.top=pos.top-this.shadowSize.top+this.shadowShift.top+'px';shadowStyle.left=pos.left-this.shadowSize.left+this.shadowShift.left+'px';shadowStyle.width=size.width+this.shadowSize.width-this.shadowShift.width+"px";var h=size.height-this.shadowShift.height+"px";this.centerElements.each(function(e){e.style.height=h});var w=size.width+this.shadowSize.width-this.shadowShift.width+"px";this.shadowContents.each(function(item){item.style.width=w});},getElementPosition:function(){return{top:this.element.getNumStyle("top"),left:this.element.getNumStyle("left")}}});document.whenReady(function(){CSS.fixPNG("shadow")});UI.IframeShim=Class.create(UI.Options,{initialize:function(){this.element=new Element('iframe',{style:'position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);display:none',src:'javascript:false;',frameborder:0});$(document.body).insert(this.element);},hide:function(){this.element.hide();return this;},show:function(){this.element.show();return this;},positionUnder:function(element){var element=$(element),offset=element.cumulativeOffset(),dimensions=element.getDimensions(),style={left:offset[0]+'px',top:offset[1]+'px',width:dimensions.width+'px',height:dimensions.height+'px',zIndex:element.getStyle('zIndex')-1};this.element.setStyle(style).show();return this;},setBounds:function(bounds){for(prop in bounds){bounds[prop]+='px';}
this.element.setStyle(bounds);return this;},setSize:function(width,height){this.element.style.width=parseInt(width)+"px";this.element.style.height=parseInt(height)+"px";return this;},setPosition:function(top,left){this.element.style.top=parseInt(top)+"px";this.element.style.left=parseInt(left)+"px";return this;},destroy:function(){if(this.element)
this.element.remove();return this;}});UI.AutoComplete=Class.create(UI.Options,{options:{className:"pui-autocomplete",maxItem:10,url:false,delay:0.2,infoMessage:false,progressMessage:false,noMatchMessage:false,shadow:false},initialize:function(element,options){this.setOptions(options);this.element=$(element).hide();this.render();this.updateInputSize();this.list=[];document.observe('keypress',this.removeSelected.bind(this));},add:function(text,options){var li=new Element("li",Object.extend({className:this.getClassName("box")},options||{}));li.observe("click",this.focus.bind(this,li)).observe("mouseover",this.over.bind(this,li)).observe("mouseout",this.out.bind(this,li));var close=new Element('a',{'href':'javascript:void(0);','class':'closebutton'});li.insert(new Element("span").update(text).insert(close));close.observe("click",this.remove.bind(this,li));this.input.parentNode.insert({before:li});this.updateInputSize();return this.fire("element:added",{element:li});},remove:function(element){element.remove();this.updateInputSize();return this.fire("element:removed",{element:element});},removeSelected:function(event){if(event.element().readAttribute("type")!="text"&&event.keyCode==Event.KEY_BACKSPACE){this.container.select("li."+this.getClassName("box")).each(function(element){if(this.isSelected(element))
this.remove(element);}.bind(this));if(event)
event.stop();}
return this;},focus:function(element,event){if(event)
event.stop();if(event&&!event.shiftKey)
this.deselectAll();element=element||this.input;if(element==this.input){this.input.focus();this.displayCompletion();}
else{this.out(element,event);element.addClassName(this.getClassName("selected"));if(element!=this.input)
this.blur();}
return this.fire("element:focus",{element:element});},blur:function(element,event){if(event)
event.stop();if(!element)
this.input.blur();this.hideAutocomplete();return this.fire("element:blur",{element:element});},over:function(element,event){if(!this.isSelected(element))
element.addClassName(this.getClassName("over"));if(event)
event.stop();return this.fire("element:over",{element:element});},out:function(element,event){if(!this.isSelected(element))
element.removeClassName(this.getClassName("over"));if(event)
event.stop();return this.fire("element:out",{element:element});},isSelected:function(element){return element.hasClassName(this.getClassName("selected"));},deselectAll:function(){this.container.select("li."+this.getClassName("box")).invoke("removeClassName",this.getClassName("selected"));return this;},setAutocompleteList:function(list){this.list=list;return this;},fire:function(eventName,memo){memo=memo||{};memo.autocomplete=this;return this.element.fire('autocomplete:'+eventName,memo);},observe:function(eventName,handler){this.element.observe('autocomplete:'+eventName,handler.bind(this));return this;},stopObserving:function(eventName,handler){this.element.stopObserving('autocomplete:'+eventName,handler);return this;},moveSelection:function(element){var current=null;if(!this.current)
current=this.autocompletionContainer.firstDescendant();else if(element=="next"){current=this.current[element]()||this.autocompletionContainer.firstDescendant();}
else if(element=="previous"){current=this.current[element]()||this.autocompletionContainer.childElements().last();}
else
current=element;if(this.current)
this.current.removeClassName(this.getClassName("current"));this.current=current;if(this.current)
this.current.addClassName(this.getClassName("current"));},addCurrent:function(){if(this.current){var index=this.autocompletionContainer.childElements().indexOf(this.current);this.add(this.selectedList[index].text);this.current=null;this.input.clear();(function(){this.input.focus()}.bind(this)).defer();this.displayCompletion();}},showMessage:function(text){if(text){this.message.update(text);this.message.show();this.showAutocomplete();}
else
this.hideAutocomplete();},runRequest:function(search){this.autocompletionContainer.hide();this.showMessage(this.options.progressMessage);new Ajax.Request(this.options.url,{parameters:{search:search,max:this.options.maxItem},onComplete:function(transport){this.setAutocompleteList(transport.responseText.evalJSON());this.timer=null;this.displayCompletion();}.bind(this)});},getClassName:function(className){return this.options.className+"-"+className;},keydown:function(event){switch(event.keyCode){case Event.KEY_UP:this.moveSelection('previous');event.stop();return false;case Event.KEY_DOWN:this.moveSelection('next');event.stop();return false;case Event.KEY_RETURN:this.addCurrent();event.stop();return false;}},keyup:function(event){switch(event.keyCode){case Event.KEY_UP:case Event.KEY_DOWN:case Event.KEY_RETURN:break;default:this.displayCompletion(event);}},updateInputSize:function(){var top;var w=this.container.select("li."+this.getClassName("box")).inject(0,function(sum,element){if(Object.isUndefined(top))
top=element.cumulativeOffset().top;else if(top!=element.cumulativeOffset().top){top=element.cumulativeOffset().top;sum=0;}
return sum+element.getWidth()+element.getMarginDimensions().width+element.getBorderDimensions().width;});var margin=this.container.getMarginDimensions().width+this.container.getBorderDimensions().width+this.container.getPaddingDimensions().width;var width=this.container.getWidth()-w-margin;if(width<50)
width=this.container.getWidth()-margin;this.input.parentNode.style.width=width+"px";this.input.style.width=width+"px";},displayCompletion:function(event){var value=this.input.value.strip();this.current=null;if(!value.empty()){if(event&&this.options.url){if(this.timer)
clearTimeout(this.timer);this.timer=this.runRequest.bind(this,value).delay(this.options.delay);}
else{this.message.hide();this.selectedList=this.list.findAll(function(entry){return entry.text.match(value)}).slice(0,this.options.maxItem);this.autocompletionContainer.update("");if(this.selectedList.empty())
this.showMessage(this.options.noMatchMessage);else{this.selectedList.each(function(entry){var li=new Element("li").update(entry.text.gsub(value,"<em>"+value+"</em>"));li.observe("mouseover",this.moveSelection.bind(this,li)).observe("mousedown",this.addCurrent.bind(this));this.autocompletionContainer.insert(li);}.bind(this));this.autocompletionContainer.show();this.moveSelection("next");this.showAutocomplete();}}}
else{this.showMessage(this.options.infoMessage);this.autocompletionContainer.hide();this.showAutocomplete();}},showAutocomplete:function(){this.autocompletion.clonePosition(this.container,{setHeight:false,offsetTop:this.container.offsetHeight});var w=this.autocompletion.getWidth();var h=this.autocompletion.getHeight();var t=parseInt(this.autocompletion.style.top);var l=parseInt(this.autocompletion.style.left);if(this.shadow){this.shadow.setBounds({top:t,left:l,width:w,height:h});this.shadow.show();}
if(this.iframe)
this.iframe.show().setPosition(t,l).setSize(w,h);this.autocompletion.show();},hideAutocomplete:function(){if(this.shadow)
this.shadow.hide();if(this.iframe)
this.iframe.hide();this.autocompletion.hide();},render:function(){this.autocompletion=new Element("div",{className:this.getClassName("result")}).hide();this.autocompletionContainer=new Element("ul",{className:this.getClassName("results")}).hide();this.message=new Element("div",{className:this.getClassName("message")}).hide();this.element.insert({after:this.autocompletion.insert(this.message).insert(this.autocompletionContainer)});this.input=new Element("input",{type:"text"});this.input.observe("focus",this.focus.bind(this,this.input)).observe("blur",this.blur.bind(this,this.input)).observe("keyup",this.keyup.bind(this)).observe("keydown",this.keydown.bind(this));this.container=new Element('ul',{className:this.getClassName("holder")}).insert(new Element("li",{className:this.getClassName("input")}).insert(this.input));this.element.insert({before:this.container});this.autocompletion.style.width=this.container.getWidth()-this.container.getBorderDimensions().width+"px";if(this.options.shadow)
this.shadow=new UI.Shadow(this.autocompletion,{theme:this.options.shadow}).hide();else
this.iframe=Prototype.Browser.IE?new UI.IframeShim():null;}});Element.addMethods({getAttributeDimensions:function(element,attribut){var dim=$w('top bottom left right').inject({},function(dims,key){dims[key]=element.getNumStyle(attribut+"-"+key+(attribut=="border"?"-width":""));return dims;});dim.width=dim.left+dim.right;dim.height=dim.top+dim.bottom;return dim;},getBorderDimensions:function(element){return element.getAttributeDimensions("border")},getMarginDimensions:function(element){return element.getAttributeDimensions("margin")},getPaddingDimensions:function(element){return element.getAttributeDimensions("padding")}});Object.extend(Date.prototype,{addDays:function(days){return new Date(this.getFullYear(),this.getMonth(),this.getDate()+days,this.getHours(),this.getMinutes(),this.getSeconds(),this.getMilliseconds());},succ:function(){return this.addDays(1);},firstOfMonth:function(){return new Date(this.getFullYear(),this.getMonth(),1);},endOfMonth:function(){return new Date(this.getFullYear(),this.getMonth()+1,0);},getDayOfYear:function(){return Math.ceil((this-new Date(this.getFullYear(),0,1))/86400000);},strftime:function(grammar){var parts={},i18n=Date.default_i18n;var lambda=function(date,part){switch(part){case'a':return i18n.WEEKDAYS_MEDIUM[date.getDay()];case'A':return i18n.WEEKDAYS[date.getDay()];case'b':case'h':return i18n.MONTHS_SHORT[date.getMonth()];case'B':return i18n.MONTHS[date.getMonth()];case'C':return Math.floor(date.getFullYear()/100);case'd':return date.getDate().toPaddedString(2);case'e':return date.getDate();case'j':return date.getDayOfYear();case'm':return(date.getMonth()+1).toPaddedString(2);case'u':return date.getDay()||7;case'w':return date.getDay();case'y':return date.getFullYear().toString().substring(2);case'Y':return date.getFullYear();case'H':return date.getHours().toPaddedString(2);case'I':return(date.getHours()%12).toPaddedString(2);case'M':return date.getMinutes().toPaddedString(2);case'p':return date.getHours()<12?'am':'pm';case'S':return date.getSeconds().toPaddedString(2);case'n':return'\n';case't':return'\t';case'D':return date.strftime('%m/%d/%y');case'r':return date.strftime('%I:%M:%S %p');case'R':return date.strftime('%H:%M:%S');case'T':return date.strftime('%H:%M:%S');case'c':return date.strftime(i18n.FORMAT_DATETIME);case'x':return date.strftime(i18n.FORMAT_DATE);case'X':return date.strftime(i18n.FORMAT_TIME);}};grammar.scan(/\w+/,function(e){var part=e.first();parts[part]=lambda(this,part);}.bind(this));return grammar.interpolate(parts,Date.STRFT_GRAMMER);},equalsDate:function(other){return(this.getMonth()==other.getMonth()&&this.getDate()==other.getDate()&&this.getFullYear()==other.getFullYear());}});Object.extend(Date,{STRFT_GRAMMER:/(^|.|\r|\n)(\%(\w+))/,default_i18n:{MONTHS_SHORT:$w('Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec'),MONTHS:$w('January February March April May June July August September October November December'),WEEKDAYS_MEDIUM:$w('Sun Mon Tue Wed Thu Fri Sat'),WEEKDAYS:$w('Sunday Monday Tuesday Wednesday Thursday Friday Saturday'),FORMAT_DATE:'%m/%d/%Y',FORMAT_TIME:'%H:%M:%S',FORMAT_DATETIME:'%x %X'},parseString:function(dateString,format){var date=new Date(),i18n=Date.default_i18n;format=format.replace('%D','%m/%d/%y');format=format.replace('%T','%H:%M:%S').replace('%r','%I:%M:%S %p').replace('%R','%H:%M:%S');format=format.replace('%c',i18n.FORMAT_DATETIME).replace('%x',i18n.FORMAT_DATE).replace('%X',i18n.FORMAT_TIME);var tokens=format.match(/%./g);dateString.split(/[^A-Za-z0-9\u00A1-\uFFFF]+/).each(function(e,i){switch(tokens[i]){case'%a':case'%A':case'%u':case'%w':break;case'%b':case'%h':date.setMonth(i18n.MONTHS_SHORT.indexOf(e));break;case'%B':date.setMonth(i18n.MONTHS.indexOf(e));break;case'%C':break;case'%d':case'%e':date.setDate(parseInt(e,10));break;case'%j':break;case'%m':date.setMonth(parseInt(e,10)-1);break;case'%w':date.setDay(parseInt(e,10));break;case'%y':var year=parseInt(e,10);if(year<50)year+=2000;if(year<100)year+=1900;date.setYear(year);break;case'%Y':date.setFullYear(parseInt(e,10));break;case'%H':date.setHours(parseInt(e,10));break;case'%I':date.setHours(parseInt(e,10));break;case'%M':date.setMinutes(parseInt(e,10));break;case'%p':if(e=='pm')date.setHours(date.getHours()+12);break;case'%S':date.setSeconds(parseInt(e,10));break;}});return date;}});Element.addMethods({center:function(container,element){element=$(element);container=$(container);var cBorders=container.borderDimensions(),eBorders=element.borderDimensions();var height=container.getHeight()-(cBorders.top+cBorders.bottom);var width=container.getWidth()-(cBorders.left+cBorders.right);var setX=((width-element.getWidth()-(eBorders.left+eBorders.right))/2);var setY=((height-element.getHeight()-(eBorders.top+eBorders.bottom))/2);setX=(setX<0)?0:setX;setY=(setY<0)?0:setY;container.relativize();return element.setStyle({top:setY+'px',left:setX+'px'});},borderDimensions:function(element){return $w('top bottom left right').inject({},function(dims,key){dims[key]=parseFloat(element.getStyle('border-'+key+'-width')||0);return dims;});}});UI.Calendar=Class.create(UI.Options,{options:{theme:'mac_os_x',format:'%m/%d/%Y',startWeekday:0,startDate:new Date()},initialize:function(element,options){this.setOptions(options);this.element=$(element);this.element.identify();this.container=new Element('div').addClassName('ui_calendar_container');this.container.setStyle({position:'relative'});this.element.addClassName(this.options.theme).insert({top:this.container});this.initDate(this.options.startDate);this.buildTable();this.buildSelector();this.update(this.date);},fire:function(eventName,memo){memo=memo||{};memo.calendar=this;return this.element.fire('calendar:'+eventName,memo);},observe:function(eventName,handler){this.element.observe('calendar:'+eventName,handler.bind(this));return this;},stopObserving:function(eventName,handler){this.element.stopObserving('calendar:'+eventName,handler);return this;},generateId:function(name){return this.element.id+name;},initDate:function(date){this.date=this.convertDate(date);},convertDate:function(date){if(!date)return null;return Object.isString(date)?Date.parseString(date,this.options.format):date;},update:function(newDate){this.updateDaysRow();this.date=newDate;var today=new Date();this.headerSpan.innerHTML=UI.Calendar.Options.MONTHS[this.date.getMonth()]+' '+this.date.getFullYear();var days=$R(this.startDay(this.date),this.lastDay(this.date));if(days.size()<42){days=$R(this.startDay(this.date),this.lastDay(this.date).addDays(42-days.size()));}
days=$A(days);var day,cell,classNames,monthDate,index,l;for(index=0,l=days.length;index<l;++index){day=days[index];cell=this.cells[index];classNames=[];cell.date=day;monthDate=day.getDate();if(day.getMonth()!=this.date.getMonth()){classNames.push('non_current');cell.innerHTML=monthDate;}else{cell.innerHTML='<a href="javascript:void(0);">'+monthDate+'</a>';if(this.selectedDay&&this.selectedDay.equalsDate(day))classNames.push('selected');}
if(today.equalsDate(day))classNames.push('today');if(cell.hasClassName('weekend'))classNames.push('weekend');if(cell.hasClassName('first'))classNames.push('first');if(cell.hasClassName('last'))classNames.push('last');cell.className=classNames.join(' ');}},updateDaysRow:function(){var dayNames=this.dayNames();this.daysRow.update('');$R(0,6).each(function(n){this.daysRow.insert({bottom:new Element('th',{'class':'dayname'}).update(dayNames[n].truncate(2,''))});}.bind(this));},onCellClick:function(event){event.stop();var element=event.element();if(element.tagName=='A')element=element.up('td');if(element.hasClassName('non_current'))return;var day=element.date;this.selectedDay=day;$w('selected selected_next selected_prev').each(function(e){this.table.select('.'+e).invoke('removeClassName',e);}.bind(this));element.addClassName('selected');var next=element.next(),prev=element.previous();if(next)next.addClassName('selected_next');if(prev)prev.addClassName('selected_prev');this.fire('click',{date:day,formattedDate:day.strftime(this.options.format)});},onMonthClick:function(event){event.stop();this.selector.setStyle({position:'absolute',top:0,left:0,'float':'left',zIndex:3});this._showSelector();},_showMask:function(){if(Prototype.Browser.IE){var borderDimensions=this.container.borderDimensions();if(!this.containerWidth){this.containerWidth=this.container.getWidth()-(borderDimensions.left+borderDimensions.right);}
if(!this.containerHeight){this.containerHeight=this.container.getHeight()-(borderDimensions.top+borderDimensions.bottom);}
this.mask.setStyle({width:this.containerWidth+'px',height:this.containerHeight+'px'});}
this.mask.show();},_hideSelector:function(){this.mask.hide();this.selector.hide();},_showSelector:function(){this.container.center(this.selector);this._showMask();this.selector.show();},buildTable:function(){this.table=new Element('table').addClassName('ui_calendar');this.table.setStyle({position:'relative'});this.buildHeader(this.date);var tbody=new Element('tbody');$R(1,42).inGroupsOf(7).each(function(week,index){var row=new Element('tr');week.each(function(day,i){var cell=new Element('td');if(i==0||i==6)cell.addClassName('weekend');if(i==0)cell.addClassName('first');if(i==6)cell.addClassName('last');row.insert({bottom:cell});});tbody.insert({bottom:row});}.bind(this));this.cells=tbody.select('td');this.cells.invoke('observe','click',this.onCellClick.bind(this));this.table.insert({bottom:tbody});this.container.insert({top:this.table});},buildSelector:function(){this.selector=new Element('div').addClassName('selector').hide();this.mask=new Element('div').hide().addClassName('ui_calendar_mask').setOpacity(0.3);this.container.insert({bottom:this.selector}).insert({bottom:this.mask});this.selector.insert({top:new Element('label',{'for':this.generateId('_select')}).update(UI.Calendar.Options.LABEL_MONTH)});var select=new Element('select');for(var i=0;i<12;i++){select.insert({bottom:new Element('option',{value:i}).update(UI.Calendar.Options.MONTHS[i])});}
this.selector.insert({bottom:select}).insert({bottom:new Element('label',{'for':this.generateId('_input')}).update(UI.Calendar.Options.LABEL_YEAR)});var input=new Element('input',{type:'text',size:4,maxLength:4,value:this.date.getFullYear()});this.selector.insert({bottom:input});var createButton=function(name,onClick){return new Element('span').addClassName('ui_calendar_button').insert({top:new Element('button',{type:'button'}).update(name).observe('click',onClick.bind(this))});};var btnCn=createButton('Cancel',function(e){this._hideSelector();}.bind(this));var btnOk=createButton('OK',function(e){this._hideSelector();this.update(new Date(input.value,select.value,1));}.bind(this));this.selector.insert({bottom:new Element('div',{textAlign:'center',width:'100%'}).addClassName('ui_calendar_button_div').insert({bottom:btnCn}).insert({bottom:btnOk})});},buildHeader:function(date){var header=new Element('thead');this.daysRow=new Element('tr',{id:this.generateId('_days_row')});var initMonthLink=function(link,direction,self){link.observe('click',function(e){e.stop();self[direction+'Month'].call(self);}).observe('mousedown',function(e){var p=new PeriodicalExecuter(function(pe){self[direction+'Month'].call(self);},.25);document.observe('mouseup',function(e){p.stop();});});};$w('prev next').each(function(d){this[d+'Link']=new Element('a').addClassName(d);initMonthLink(this[d+'Link'],d,this);}.bind(this));this.headerSpan=new Element('a',{href:'javascript:void(0);'}).update(UI.Calendar.Options.MONTHS[date.getMonth()]+' '+date.getFullYear()).observe('click',this.onMonthClick.bind(this));var headerDiv=new Element('div').addClassName('header').insert({bottom:this.prevLink}).insert({bottom:this.headerSpan}).insert({bottom:this.nextLink});this.updateDaysRow();header.insert({bottom:new Element('tr').insert({top:new Element('th',{colspan:7}).update(headerDiv).addClassName('monthname')})}).insert({bottom:this.daysRow});this.table.insert({top:header});},nextMonth:function(){this.date.setMonth(this.date.getMonth()+1);this.update(this.date);},prevMonth:function(){this.date.setMonth(this.date.getMonth()-1);this.update(this.date);},startDay:function(date){var startDate=date.firstOfMonth();startDate.setDate(-(startDate.getDay()%7));startDate.setDate(startDate.getDate()+1+parseInt(this.options.startWeekday));return startDate;},lastDay:function(date){var endDate=date.endOfMonth();endDate.setDate(endDate.getDate()+6-(endDate.getDay()%7));return endDate;},dayNames:function(){var days=UI.Calendar.Options.WEEKDAYS.slice(this.options.startWeekday);for(var i=0;i<this.options.startWeekday;i++)days.push(UI.Calendar.Options.WEEKDAYS[i]);return days;},setStartWeekday:function(start){this.options.startWeekday=start;this.update(this.date);}});UI.Calendar.Options={MONTHS_SHORT:$w('Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec'),MONTHS:$w('January February March April May June July August September October November December'),WEEKDAYS_1CHAR:$w('S M T W T F S'),WEEKDAYS_SHORT:$w('Su Mo Tu We Th Fr Sa'),WEEKDAYS_MEDIUM:$w('Sun Mon Tue Wed Thu Fri Sat'),WEEKDAYS:$w('Sunday Monday Tuesday Wednesday Thursday Friday Saturday'),FORMAT_DATE:'%m/%d/%Y',FORMAT_TIME:'%H:%M:%S',FORMAT_DATETIME:'%x %X',LABEL_MONTH:"Month",LABEL_YEAR:"Year"};UI.Dock=Class.create(UI.Options,{options:{maxItemSize:96,range:2,hideLabels:false,labelsSelector:'.label'},initialize:function(element,options){this.element=$(element);this.setOptions(options);this.scale=0;this.create();},create:function(){this.createSchedulers();this.parseItems();this.observeElement();if(this.options.hideLabels)
this.items.pluck('label').invoke('hide');this.options.itemSize=this.options.itemSize||this.items.first().size;var offset=this.options.maxItemSize-this.options.itemSize;this.items.pluck('element').invoke('setStyle',{top:"-"+offset+"px",position:"relative"},this);this.element.style.height=this.options.itemSize+"px";this.redrawItems();},parseItems:function(){var selector=this.options.labelsSelector;this.items=this.element.select('LI').collect(function(LI,i){LI._dockPosition=i;return{element:LI,image:LI.down('img'),size:parseInt(LI.down('img').readAttribute('width')),label:LI.down(selector)}});},findEventItem:function(event){var element=event.findElement('LI');return element&&this.items[element._dockPosition];},createSchedulers:function(){this.magnifyScheduler=new PeriodicalExecuter(this.magnifyStep.bind(this),0.01);this.magnifyScheduler.stop();this.closeScheduler=new PeriodicalExecuter(this.closeStep.bind(this),0.01);this.closeScheduler.stop();},onMouseOver:function(event){var item=this.findEventItem(event);if(!item)return;if(this.options.hideLabels)
this.shownLabel=item.label.show();},onMouseMove:function(event){this.magnify();var item=this.findEventItem(event);if(!item)return;var index=this.items.indexOf(item),across=(event.layerX||event.offsetX)/this.items[index].size;if(!across)return;this.items.each(function(item,i){item.size=this.itemSize+(((i<index-this.range)||(i>index+this.range))?0:((this.maxItemSize-this.itemSize)*(Math.cos(i-index-across+0.5)+1)/2).ceil());},this.options);this.redrawItems();},onMouseOut:function(event){if(this.closeTimeout||this.closeScheduler.timer)
return;this.closeTimeout=this.close.bind(this).delay(0.05);if(this.options.hideLabels)
this.shownLabel.hide();},magnify:function(){if(this.closeTimeout){window.clearTimeout(this.closeTimeout);this.closeTimeout=false;}
this.closeScheduler.stop();if(this.scale!=1&&!this.magnifyScheduler.timer)
this.magnifyScheduler.registerCallback();},close:function(){this.closeTimeout=false;this.magnifyScheduler.stop();this.closeScheduler.registerCallback();},magnifyStep:function(scheduler){if(this.scale<1)this.scale+=0.125;else{this.scale=1;scheduler.stop();}
this.redrawItems();},closeStep:function(scheduler){if(this.scale>0)this.scale-=0.125;else{this.scale=0;scheduler.stop();}
this.redrawItems();},observeElement:function(){this.element.observe('mouseover',this.onMouseOver.bind(this)).observe('mousemove',this.onMouseMove.bind(this)).observe('mouseout',this.onMouseOut.bind(this));},redrawItems:function(){var itemSize=this.options.itemSize,maxSize=this.options.maxItemSize,totalSize=0;this.items.each(function(item){var size=itemSize+this.scale*(item.size-itemSize),image=item.image;image.setAttribute('width',size);image.setAttribute('height',size);image.style.marginTop=maxSize-size+'px';if(item.label)
item.label.style.width=size+'px';totalSize+=size;},this);this.element.style.width=totalSize+'px';}});UI.ContextMenu=Class.create(UI.Options,{options:{className:'ui-context_menu',beforeShow:Prototype.emptyFunction,beforeHide:Prototype.emptyFunction,beforeSelect:Prototype.emptyFunction,zIndex:900,pageOffset:25,showEffect:false,hideEffect:false,shadow:"mac_shadow"},initialize:function(options){this.setOptions(options);if(Object.isUndefined(Effect)){this.options.showEffect=this.options.hideEffect=false;}
this.iframe=Prototype.Browser.IE?new UI.IframeShim():null;this.create();this.shadow=this.options.shadow?UI.ContextMenu.shadow||new UI.Shadow(this.element,{theme:this.options.shadow}).focus().hide():null;if(this.shadow)
UI.ContextMenu.shadow=this.shadow;this.initObservers();},create:function(){this.element=new Element('div',{className:this.options.className,style:'display: none'});this.element.insert(this.createList(this.options.menuItems));$(document.body).insert(this.element.observe('contextmenu',Event.stop));},createList:function(items){var list=new Element('ul');items.each(function(item){list.insert(new Element('li',{className:item.separator?'separator':''}).insert(!item.separator?Object.extend(new Element('a',{href:'javascript:void(0);',title:item.name,className:(item.className||'')
+(item.disabled?' disabled':'')
+(item.submenu?' submenu':'')}),{_callback:item.callback}).observe('click',item.callback?this.onSelect.bind(this):Event.stop).observe('contextmenu',Event.stop).update(item.name).insert(item.submenu?this.createList(item.submenu).wrap({className:this.options.className,style:'display:none'}):''):''))}.bind(this));return list;},initObservers:function(){var contextEvent=Prototype.Browser.Opera?'click':'contextmenu';document.observe('click',function(e){if(this.element.visible()&&!e.isRightClick()){this.options.beforeHide();if(this.iframe)
this.iframe.hide();this.hide();}}.bind(this));$$(this.options.selector).invoke('observe',contextEvent,function(e){if(Prototype.Browser.Opera&&!e.ctrlKey)return;this.show(e);}.bind(this));this.element.select('a.submenu').invoke('observe','mouseover',function(e){if(this.hasClassName('disabled'))return;this.down('.menu').setStyle({top:0,left:this.getWidth()+'px'}).show();}).invoke('observe','mouseout',function(e){this.down('.menu').hide();});if(this.shadow)
this.shadow.shadow.observe('contextmenu',Event.stop);},show:function(e){if(e)e.stop();this.options.beforeShow();this.fire('showing');if(UI.ContextMenu.shownMenu){UI.ContextMenu.shownMenu.hide();}
UI.ContextMenu.shownMenu=this;this.position(e);if(this.options.showEffect){Effect.Appear(this.element,{duration:0.25,afterFinish:function(){this.fire('shown')}.bind(this)})}
else{this.element.show();this.fire('shown');}
this.event=e;return this;},position:function(e){var x=Event.pointer(e).x,y=Event.pointer(e).y,vpDim=document.viewport.getDimensions(),vpOff=document.viewport.getScrollOffset(),elDim=this.element.getDimensions(),elOff={left:((x+elDim.width+this.options.pageOffset)>vpDim.width?(vpDim.width-elDim.width-this.options.pageOffset):x),top:((y-vpOff.top+elDim.height)>vpDim.height&&(y-vpOff.top)>elDim.height?(y-elDim.height):y)},elBounds=Object.clone(Object.extend(elOff,elDim));for(prop in elOff){elOff[prop]+='px';}
this.element.setStyle(elOff).setStyle({zIndex:this.options.zIndex});if(this.iframe){this.iframe.setBounds(elBounds).show();}
if(this.shadow){this.shadow.setBounds(elBounds).show();}
return this;},hide:function(){this.options.beforeHide();if(this.iframe)
this.iframe.hide();if(this.shadow)
this.shadow.hide();if(this.options.hideEffect){Effect.Fade(this.element,{duration:0.25,afterFinish:function(){this.fire('hidden')}.bind(this)})}
else{this.element.hide();this.fire('hidden')}
return this;},onSelect:function(e){if(e.target._callback&&!e.target.hasClassName('disabled')){this.options.beforeSelect();this.fire('selected');this.hide();e.target._callback(e,this.event);}},fire:function(eventName){this.element.fire('contextmenu:'+eventName);}});UI.Window=Class.create(UI.Options,{options:{theme:null,shadowTheme:null,id:null,windowManager:null,top:null,left:null,width:200,height:300,minHeight:100,minWidth:200,maxHeight:null,maxWidth:null,altitude:"front",resizable:true,draggable:true,wired:false,show:Element.show,hide:Element.hide,superflousEffects:!Object.isUndefined(window.Effect),shadow:false,activeOnClick:true,gridX:1,gridY:1,close:'destroy',minimize:'toggleFold',maximize:'toggleMaximize'},initialize:function(options){this.setOptions(options);this.windowManager=this.options.windowManager||UI.defaultWM;this.create();this.id=this.element.id;this.windowManager.register(this);this.render();if(this.options.activeOnClick)
this.overlay.setStyle({zIndex:this.lastZIndex+1}).show();},destroy:function($super){this.hide();if(this.centerOptions)
Event.stopObserving(this.windowManager.scrollContainer,"scroll",this.centerOptions.handler);this.windowManager.unregister(this);this.fire('destroyed');},fire:function(eventName,memo){memo=memo||{};memo.window=this;return(this.savedElement||this.element).fire('window:'+eventName,memo);},observe:function(eventName,handler){this.element.observe('window:'+eventName,handler.bind(this));return this;},show:function(modal){if(this.visible)return this;this.fire('showing');this.effect('show');if(modal){this.windowManager.startModalSession(this);this.modalSession=true;}
this.addElements();this.visible=true;new PeriodicalExecuter(function(executer){if(!this.element.visible())return;this.fire('shown');executer.stop();}.bind(this),0.1);return this;},hide:function(){if(!this.visible)return this;this.fire('hiding');this.effect('hide');if(this.modalSession){this.windowManager.endModalSession(this);this.modalSession=false;}
this.windowManager.hide(this);new PeriodicalExecuter(function(executer){if(this.element.visible())return;this.visible=false;this.element.remove();this.fire('hidden');executer.stop();}.bind(this),0.1);return this;},close:function(){return this.action('close');},activate:function(){return this.bringToFront().focus();},bringToFront:function(){return this.setAltitude('front');},sendToBack:function(){return this.setAltitude('back');},focus:function(){if(this.focused)return this;this.windowManager.focus(this);this.overlay.hide();this.element.addClassName(this.options.theme+'_focused');this.focused=true;this.fire('focused');return this;},blur:function(){if(!this.focused)return this;this.windowManager.blur(this);this.element.removeClassName(this.options.theme+'_focused');if(this.options.activeOnClick)
this.overlay.setStyle({zIndex:this.lastZIndex+1}).show();this.focused=false;this.fire('blurred');return this;},maximize:function(){if(this.maximized)return this;var bounds=this.getBounds();if(this.windowManager.maximize(this)){this.disableButton('minimize').setResizable(false).setDraggable(false);this.activate();this.maximized=true;this.savedArea=bounds;var newBounds=Object.extend(this.windowManager.viewport.getDimensions(),{top:0,left:0});this[this.options.superflousEffects&&!Prototype.Browser.IE?"morph":"setBounds"](newBounds);this.fire('maximized');return this;}},restore:function(){if(!this.maximized)return this;if(this.windowManager.restore(this)){this[this.options.superflousEffects&&!Prototype.Browser.IE?"morph":"setBounds"](this.savedArea);this.enableButton("minimize").setResizable(true).setDraggable(true);this.maximized=false;this.fire('restored');return this;}},toggleMaximize:function(){return this.maximized?this.restore():this.maximize();},adapt:function(){var dimensions=this.content.getScrollDimensions();if(this.options.superflousEffects)
this.morph(dimensions,true);else
this.setSize(dimensions.width,dimensions.height,true);return this;},fold:function(){if(!this.folded){var size=this.getSize(true);this.folded=true;this.savedInnerHeight=size.height;if(this.options.superflousEffects)
this.morph({width:size.width,height:0},true);else
this.setSize(size.width,0,true);this.setResizable(false);this.fire("fold");}
return this;},unfold:function(){if(this.folded){var size=this.getSize(true);this.folded=false;if(this.options.superflousEffects)
this.morph({width:size.width,height:this.savedInnerHeight},true);else
this.setSize(size.width,this.savedInnerHeight,true);this.setResizable(true);this.fire("unfold");}
return this;},toggleFold:function(){return this.folded?this.unfold():this.fold();},setHeader:function(header){this.header.update(header);return this;},setContent:function(content){this.content.update(content);return this;},setFooter:function(footer){this.footer.update(footer);return this;},setAjaxContent:function(url,options){if(!options)
options={};Object.keys(options).each(function(name){if(Object.isFunction(options[name]))
options[name]=options[name].bind(this);},this);var onComplete=options.onComplete;options.onComplete=(function(response,json){this.setContent(response.responseText);if(Object.isFunction(onComplete))onComplete(response,json);}).bind(this);new Ajax.Request(url,options);return this;},getPosition:function(){return{left:this.options.left,top:this.options.top};},setPosition:function(top,left){var pos=this.computePosition(top,left);this.options.top=pos.top;this.options.left=pos.left;var elementStyle=this.element.style;elementStyle.top=pos.top+'px';elementStyle.left=pos.left+'px';this.fire('position:changed');return this;},center:function(options){var size=this.getSize(),windowManager=this.windowManager,viewport=windowManager.viewport;viewportArea=viewport.getDimensions(),offset=viewport.getScrollOffset();if(options&&options.auto){this.centerOptions=Object.extend({handler:this.recenter.bind(this)},options);Event.observe(this.windowManager.scrollContainer,"scroll",this.centerOptions.handler);Event.observe(window,"resize",this.centerOptions.handler);}
options=Object.extend({top:(viewportArea.height-size.height)/2,left:(viewportArea.width-size.width)/2},options||{});return this.setPosition(options.top+offset.top,options.left+offset.left);},bottomRight:function(options){var size=this.getSize(),windowManager=this.windowManager,viewport=windowManager.viewport;viewportArea=viewport.getDimensions(),offset=viewport.getScrollOffset();options=Object.extend({top:(viewportArea.height-(size.height+30)),left:(viewportArea.width-(size.width+30))},options||{});return this.setPosition(options.top,options.left);},getSize:function(innerSize){if(innerSize)
return{width:this.options.width-this.borderSize.width,height:this.options.height-this.borderSize.height};else
return{width:this.options.width,height:this.options.height};},setSize:function(width,height,innerSize){var size=this.computeSize(width,height,innerSize);var elementStyle=this.element.style,contentStyle=this.content.style;this.options.width=size.outerWidth;this.options.height=size.outerHeight;elementStyle.width=size.outerWidth+"px",elementStyle.height=size.outerHeight+"px";contentStyle.width=size.innerWidth+"px",contentStyle.height=size.innerHeight+"px";this.overlay.style.height=size.innerHeight+"px";this.fire('size:changed');return this;},getBounds:function(innerSize){return Object.extend(this.getPosition(),this.getSize(innerSize));},setBounds:function(bounds,innerSize){return this.setPosition(bounds.top,bounds.left).setSize(bounds.width,bounds.height,innerSize);},morph:function(bounds,innerSize){bounds=Object.extend(this.getBounds(innerSize),bounds||{});if(this.centerOptions&&this.centerOptions.auto)
bounds=Object.extend(bounds,this.computeRecenter(bounds));if(innerSize){bounds.width+=this.borderSize.width;bounds.height+=this.borderSize.height;}
this.animating=true;new UI.Window.Effects.Morph(this,bounds,{duration:0.5,afterFinish:function(){this.animating=false}.bind(this)});Object.extend(this.options,bounds);return this;},getAltitude:function(){return this.windowManager.getAltitude(this);},setAltitude:function(altitude){if(this.windowManager.setAltitude(this,altitude))
this.fire('altitude:changed');return this;},setResizable:function(resizable){this.options.resizable=resizable;var toggleClassName=(resizable?'add':'remove')+'ClassName';this.element[toggleClassName]('resizable').select('div:[class*=_sizer]').invoke(resizable?'show':'hide');if(resizable)
this.createResizeHandles();this.element.select('div.se').first()[toggleClassName]('se_resize_handle');return this;},setDraggable:function(draggable){this.options.draggable=draggable;this.element[(draggable?'add':'remove')+'ClassName']('draggable');return this;},getTheme:function(){return this.options.theme||this.windowManager.getTheme();},setTheme:function(theme,windowManagerTheme){this.element.removeClassName(this.getTheme()).addClassName(theme);if(!windowManagerTheme)
this.options.theme=theme;return this;},getShadowTheme:function(){return this.options.shadowTheme||this.windowManager.getShadowTheme();}});UI.Window.addMethods(UI.Window.Buttons);UI.Window.addMethods(UI.Window.Shadow);UI.Window.optionsAccessor($w(" minWidth minHeight maxWidth maxHeight gridX gridY altitude "));UI.Window.addMethods({style:"position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0;",action:function(name){var action=this.options[name];if(action)
Object.isString(action)?this[action]():action.call(this,this);},create:function(){function createDiv(className,options){return new Element('div',Object.extend({className:className},options));};this.element=createDiv("ui-window "+this.getTheme(),{id:this.options.id,style:"top:-10000px; left:-10000px"});this.header=createDiv('n move_handle').enableDrag();this.content=createDiv('content').appendText(' ');this.footer=createDiv('s move_handle').enableDrag();var header=createDiv('nw').insert(createDiv('ne').insert(this.header));var content=createDiv('w').insert(createDiv('e',{style:"position:relative"}).insert(this.content));var footer=createDiv('sw').insert(createDiv('se'+(this.options.resizable?" se_resize_handle":"")).insert(this.footer));this.element.insert(header).insert(content).insert(footer).identify('ui-window');this.header.observe('mousedown',this.activate.bind(this));this.setDraggable(this.options.draggable);this.setResizable(this.options.resizable);this.overlay=new Element('div',{style:this.style+"display: none"}).observe('mousedown',this.activate.bind(this));if(this.options.activeOnClick)
this.content.insert({before:this.overlay});},createWiredElement:function(){this.wiredElement=this.wiredElement||new Element("div",{className:this.getTheme()+"_wired",style:"display: none; position: absolute; top: 0; left: 0"});},createResizeHandles:function(){$w(" n  w  e  s  nw  ne  sw  se ").each(function(id){this.insert(new Element("div",{className:id+"_sizer resize_handle",drag_prefix:id}).enableDrag());},this.element);this.createResizeHandles=Prototype.emptyFunction;},render:function(){this.addElements();this.computeBorderSize();this.updateButtonsOrder();this.element.hide().remove();return this.setBounds(this.options);},addElements:function(){this.windowManager.container.appendChild(this.element);},setZIndex:function(zIndex){if(this.zIndex!=zIndex){this.zIndex=zIndex;[this.element].concat(this.element.childElements()).each(function(element){element.style.zIndex=zIndex++;});this.lastZIndex=zIndex;}
return this;},effect:function(name,element,options){var effect=this.options[name]||Prototype.emptyFunction;effect(element||this.element,options||{});},computeBorderSize:function(){if(this.element){if(Prototype.Browser.IEVersion>=7)
this.content.style.width="100%";var dim=this.element.getDimensions(),pos=this.content.positionedOffset();this.borderSize={top:pos[1],bottom:dim.height-pos[1]-this.content.getHeight(),left:pos[0],right:dim.width-pos[0]-this.content.getWidth()};this.borderSize.width=this.borderSize.left+this.borderSize.right;this.borderSize.height=this.borderSize.top+this.borderSize.bottom;if(Prototype.Browser.IEVersion>=7)
this.content.style.width="auto";}},computeSize:function(width,height,innerSize){var innerWidth,innerHeight,outerWidth,outerHeight;if(innerSize){outerWidth=width+this.borderSize.width;outerHeight=height+this.borderSize.height;}else{outerWidth=width;outerHeight=height;}
if(!this.animating){outerWidth=outerWidth.snap(this.options.gridX);outerHeight=outerHeight.snap(this.options.gridY);if(!this.folded){if(outerWidth<this.options.minWidth)
outerWidth=this.options.minWidth;if(outerHeight<this.options.minHeight)
outerHeight=this.options.minHeight;}
if(this.options.maxWidth&&outerWidth>this.options.maxWidth)
outerWidth=this.options.maxWidth;if(this.options.maxHeight&&outerHeight>this.options.maxHeight)
outerHeight=this.options.maxHeight;}
if(this.centerOptions&&this.centerOptions.auto)
this.recenter();innerWidth=outerWidth-this.borderSize.width;innerHeight=outerHeight-this.borderSize.height;return{innerWidth:innerWidth,innerHeight:innerHeight,outerWidth:outerWidth,outerHeight:outerHeight};},computePosition:function(top,left){if(this.centerOptions&&this.centerOptions.auto)
return this.computeRecenter(this.getSize());;return{top:this.animating?top:top.snap(this.options.gridY),left:this.animating?left:left.snap(this.options.gridX)};},computeRecenter:function(size){var viewport=this.windowManager.viewport,area=viewport.getDimensions(),offset=viewport.getScrollOffset(),center={top:Object.isUndefined(this.centerOptions.top)?(area.height-size.height)/2:this.centerOptions.top,left:Object.isUndefined(this.centerOptions.left)?(area.width-size.width)/2:this.centerOptions.left};return{top:parseInt(center.top+offset.top),left:parseInt(center.left+offset.left)};},recenter:function(event){var pos=this.computeRecenter(this.getSize());this.setPosition(pos.top,pos.left);}});UI.URLWindow=Class.create(UI.Window,{options:{url:'about:blank'},afterClassCreate:function(){this.undefMethod('setAjaxContent');},initialize:function($super,options){$super(options);this.createIFrame();},destroy:function($super){this.iframe.src=null;$super();},getUrl:function(){return this.iframe.src;},setUrl:function(url,options){this.iframe.src=url;return this;},createIFrame:function($super){this.iframe=new Element('iframe',{style:this.style,frameborder:0,src:this.options.url,name:this.element.id+"_frame",id:this.element.id+"_frame"});this.content.insert(this.iframe);}});if(!Object.isUndefined(window.Effect)){UI.Window.Effects=UI.Window.Effects||{};UI.Window.Effects.Morph=Class.create(Effect.Base,{initialize:function(window,bounds){this.window=window;var options=Object.extend({fromBounds:this.window.getBounds(),toBounds:bounds,from:0,to:1},arguments[2]||{});this.start(options);},update:function(position){var t=this.options.fromBounds.top+(this.options.toBounds.top-this.options.fromBounds.top)*position;var l=this.options.fromBounds.left+(this.options.toBounds.left-this.options.fromBounds.left)*position;var ow=this.options.fromBounds.width+(this.options.toBounds.width-this.options.fromBounds.width)*position;var oh=this.options.fromBounds.height+(this.options.toBounds.height-this.options.fromBounds.height)*position;this.window.setBounds({top:t,left:l,width:ow,height:oh})}});}
UI.Window.addMethods({startDrag:function(handle){this.initBounds=this.getBounds();this.activate();if(this.options.wired){this.createWiredElement();this.wiredElement.style.cssText=this.element.style.cssText;this.element.hide();this.saveElement=this.element;this.windowManager.container.appendChild(this.wiredElement);this.element=this.wiredElement;}
handle.hasClassName('resize_handle')?this.startResize(handle):this.startMove();},endDrag:function(){this.element.hasClassName('resized')?this.endResize():this.endMove();if(this.options.wired){this.saveElement.style.cssText=this.wiredElement.style.cssText;this.wiredElement.remove();this.element=this.saveElement;this.saveElement=false;}},startMove:function(){this.drag=this.moveDrag;this.element.addClassName('moved');this.fire('move:started');},endMove:function(){this.element.removeClassName('moved');this.fire('move:ended');},startResize:function(handle){this.drag=this[handle.readAttribute('drag_prefix')+'Drag'];this.element.addClassName('resized');this.fire('resize:started');},endResize:function(){this.element.removeClassName('resized');this.fire('resize:ended');},moveDrag:function(dx,dy){this.setPosition(this.initBounds.top+dy,this.initBounds.left+dx);},swDrag:function(dx,dy){var initBounds=this.initBounds;this.setSize(initBounds.width-dx,initBounds.height+dy).setPosition(initBounds.top,initBounds.left+(initBounds.width-this.getSize().width));},seDrag:function(dx,dy){this.setSize(this.initBounds.width+dx,this.initBounds.height+dy);},nwDrag:function(dx,dy){var initBounds=this.initBounds;this.setSize(initBounds.width-dx,initBounds.height-dy).setPosition(initBounds.top+(initBounds.height-this.getSize().height),initBounds.left+(initBounds.width-this.getSize().width));},neDrag:function(dx,dy){var initBounds=this.initBounds;this.setSize(initBounds.width+dx,initBounds.height-dy).setPosition(initBounds.top+(initBounds.height-this.getSize().height),initBounds.left);},wDrag:function(dx,dy){var initBounds=this.initBounds;this.setSize(initBounds.width-dx,initBounds.height).setPosition(initBounds.top,initBounds.left+(initBounds.width-this.getSize().width));},eDrag:function(dx,dy){this.setSize(this.initBounds.width+dx,this.initBounds.height);},nDrag:function(dx,dy){var initBounds=this.initBounds;this.setSize(initBounds.width,initBounds.height-dy).setPosition(initBounds.top+(initBounds.height-this.getSize().height),initBounds.left);},sDrag:function(dx,dy){this.setSize(this.initBounds.width,this.initBounds.height+dy);}});UI.Window.addMethods({methodsAdded:function(base){base.aliasMethodChain('create','buttons');base.aliasMethodChain('destroy','buttons');},createWithButtons:function(){this.createWithoutButtons();if(!this.options.resizable){this.options.minimize=false;this.options.maximize=false;}
this.buttons=new Element("div",{className:"buttons"}).observe('click',this.onButtonsClick.bind(this)).observe('mouseover',this.onButtonsHover.bind(this)).observe('mouseout',this.onButtonsOut.bind(this));this.element.insert(this.buttons);this.defaultButtons.each(function(button){if(this.options[button]!==false)
this.addButton(button);},this);},destroyWithButtons:function(){this.buttons.stopObserving();this.destroyWithoutButtons();},defaultButtons:$w(' minimize maximize close '),getButtonElement:function(buttonName){return this.buttons.down("."+buttonName);},addButton:function(buttonName,action){this.buttons.insert(new Element("a",{className:buttonName,href:"javascript:void(0);"}));if(action)
this.options[buttonName]=action;return this;},removeButton:function(buttonName){this.getButtonElement(buttonName).remove();return this;},disableButton:function(buttonName){this.getButtonElement(buttonName).addClassName("disabled");return this;},enableButton:function(buttonName){this.getButtonElement(buttonName).removeClassName("disabled");return this;},onButtonsClick:function(event){var element=event.findElement('a:not(.disabled)');if(element)this.action(element.className);event.stop();},onButtonsHover:function(event){this.buttons.addClassName("over");},onButtonsOut:function(event){this.buttons.removeClassName("over");},updateButtonsOrder:function(){var buttons=this.buttons.childElements();buttons.inject(new Array(buttons.length),function(array,button){array[parseInt(button.getStyle("padding-top"))]=button.setStyle("padding: 0");return array;}).each(function(button){this.buttons.insert(button)},this);}});UI.Window.addMethods({methodsAdded:function(base){(function(methods){$w(methods).each(function(m){base.aliasMethodChain(m,'shadow')});})(' create addElements setZIndex setPosition setSize setBounds ');},showShadow:function(){if(this.shadow){this.shadow.hide();this.effect('show',this.shadow.shadow);}},hideShadow:function(){if(this.shadow)
this.effect('hide',this.shadow.shadow);},removeShadow:function(){if(this.shadow)
this.shadow.remove();},focusShadow:function(){if(this.shadow)
this.shadow.focus();},blurShadow:function(){if(this.shadow)
this.shadow.blur();},createWithShadow:function(){this.createWithoutShadow();this.observe('showing',this.showShadow).observe('hiding',this.hideShadow).observe('hidden',this.removeShadow).observe('focused',this.focusShadow).observe('blurred',this.blurShadow);if(this.options.shadow)
this.shadow=new UI.Shadow(this.element,{theme:this.getShadowTheme()});},addElementsWithShadow:function(){this.addElementsWithoutShadow();if(this.shadow){this.shadow.setBounds(this.options).render();}},setZIndexWithShadow:function(zIndex){if(this.zIndex!=zIndex){if(this.shadow)
this.shadow.setZIndex(zIndex-1);this.setZIndexWithoutShadow(zIndex);this.zIndex=zIndex;}
return this;},setPositionWithShadow:function(top,left){this.setPositionWithoutShadow(top,left);if(this.shadow){var pos=this.getPosition();this.shadow.setPosition(pos.top,pos.left);}
return this;},setSizeWithShadow:function(width,height,innerSize){this.setSizeWithoutShadow(width,height,innerSize);if(this.shadow){var size=this.getSize();this.shadow.setSize(size.width,size.height);}
return this;},setBoundsWithShadow:function(bounds,innerSize){this.setBoundsWithoutShadow(bounds,innerSize);if(this.shadow)
this.shadow.setBounds(this.getBounds());}});UI.Dialog=Class.create(UI.Window,{options:{buttons:null,beforeSelect:Prototype.trueFunction,close:false,resizable:false,activeOnClick:false},disableDialogButton:function(index){var button=this.getDialogButton(index);if(button)
button.addClassName("disabled");return this;},enableDialogButton:function(index){var button=this.getDialogButton(index);if(button)
button.removeClassName("disabled");return this;},getDialogButton:function(index){var buttons=this.buttonContainer.childElements();if(index>=0&&index<buttons.length)
return buttons[index];else
return null;},create:function($super){$super();this.buttonContainer=this.createButtons();this.dialogContent=new Element('div',{className:'ui-dialog-content'});this.content.update(this.dialogContent);this.content.insert(this.buttonContainer);},addElements:function($super){$super();this.buttonsHeight=this.buttonContainer.getHeight()||this.buttonsHeight;this.setDialogSize();},setContent:function(content,withoutButton){this.dialogContent.update(content);if(withoutButton&&this.buttonContainer.parentNode)
this.buttonContainer.remove();else
this.content.insert(this.buttonContainer);this.setDialogSize();return this;},onSelect:function(e){var element=e.element();if(element.callback&&!element.hasClassName('disabled')){if(this.options.beforeSelect(element))
element.callback(this);}},createButtons:function(dialogButtons){var buttonContainer=new Element('div',{className:'ui-dialog-buttons'});(this.options.buttons||UI.Dialog.okCancelButtons).each(function(item){var button;if(item.separator)
button=new Element('span',{className:'separator'});else
button=new Element('button',{title:item.title,className:(item.className||'')+(item.disabled?' disabled':'')}).observe('click',this.onSelect.bind(this)).update(item.title);buttonContainer.insert(button);button.callback=item.callback;}.bind(this));return buttonContainer;},setDialogSize:function(){if(!this.borderSize)
return;this.buttonsHeight=this.buttonContainer.getHeight()||this.buttonsHeight;var style=this.dialogContent.style,size=this.getSize(true);style.width=size.width+"px",style.height=size.height-this.buttonsHeight+"px";},setSize:function($super,width,height,innerSize){$super(width,height,innerSize);this.setDialogSize();return this;}});UI.Dialog=Object.extend(UI.Dialog,{okButton:[{title:'Ok',className:'ok',callback:function(win){win.destroy();}}],okCancelButtons:[{title:'Ok',className:'ok',callback:function(win){win.destroy();}},{title:'Cancel',className:'cancel',callback:function(win){win.destroy();}}]})
UI.WindowManager=Class.create(UI.Options,{options:{container:null,zIndex:0,theme:"alphacube",shadowTheme:"mac_shadow",showOverlay:Element.show,hideOverlay:Element.hide,positionningStrategy:function(win,area){UI.WindowManager.DumbPositionningStrategy(win,area);}},initialize:function(options){this.setOptions(options);this.container=$(this.options.container||document.body);if(this.container===$(document.body)){this.viewport=document.viewport;this.scrollContainer=window;}else{this.viewport=this.scrollContainer=this.container;}
this.container.observe('drag:started',this.onStartDrag.bind(this)).observe('drag:updated',this.onDrag.bind(this)).observe('drag:ended',this.onEndDrag.bind(this));this.stack=new UI.WindowManager.Stack();this.modalSessions=0;this.createOverlays();this.resizeEvent=this.resize.bind(this);Event.observe(window,"resize",this.resizeEvent);},destroy:function(){this.windows().invoke('destroy');this.stack.destroy();Event.stopObserving(window,"resize",this.resizeEvent);},setTheme:function(theme){this.stack.windows.select(function(w){return!w.options.theme;}).invoke('setTheme',theme,true);this.options.theme=theme;return this;},register:function(win){if(this.getWindow(win.id))return;this.handlePosition(win);this.stack.add(win);this.restartZIndexes();},unregister:function(win){this.stack.remove(win);if(win==this.focusedWindow)
this.focusedWindow=null;},getWindow:function(element){element=$(element);if(!element)return;if(!element.hasClassName('ui-window'))
element=element.up('.ui-window');var id=element.id;return this.stack.windows.find(function(win){return win.id==id});},windows:function(){return this.stack.windows.clone();},getFocusedWindow:function(){return this.focusedWindow;},startModalSession:function(win){if(!this.modalSessions){this.removeOverflow();this.modalOverlay.className=win.getTheme()+"_overlay";this.container.appendChild(this.modalOverlay);if(!this.modalOverlay.opacity)
this.modalOverlay.opacity=this.modalOverlay.getOpacity();this.modalOverlay.setStyle("height: "+this.viewport.getHeight()+"px");this.options.showOverlay(this.modalOverlay,{from:0,to:this.modalOverlay.opacity});}
this.modalOverlay.setStyle({zIndex:win.zIndex-1});this.modalSessions++;},endModalSession:function(win){this.modalSessions--;if(this.modalSessions){this.modalOverlay.setStyle({zIndex:this.stack.getPreviousWindow(win).zIndex-1});}else{this.resetOverflow();this.options.hideOverlay(this.modalOverlay,{from:this.modalOverlay.opacity,to:0});}},moveHandleSelector:'.ui-window.draggable .move_handle',resizeHandleSelector:'.ui-window.resizable .resize_handle',onStartDrag:function(event){var handle=event.element(),isMoveHandle=handle.match(this.moveHandleSelector),isResizeHandle=handle.match(this.resizeHandleSelector);if(isResizeHandle||isMoveHandle){event.stop();var win=this.getWindow(event.findElement('.ui-window'));this.container.insert(this.dragOverlay.setStyle({zIndex:this.getLastZIndex()}));win.startDrag(handle);this.draggedWindow=win;}},onDrag:function(event){if(this.draggedWindow){event.stop();this.draggedWindow.drag(event.memo.dx,event.memo.dy);}},onEndDrag:function(event){if(this.draggedWindow){event.stop();this.dragOverlay.remove();this.draggedWindow.endDrag();this.draggedWindow=null;}},maximize:function(win){this.removeOverflow();this.maximizedWindow=win;return true;},restore:function(win){if(this.maximizedWindow){this.resetOverflow();this.maximizedWindow=false;}
return true;},removeOverflow:function(){var container=this.container;container.savedOverflow=container.style.overflow||"auto";container.savedOffset=this.viewport.getScrollOffset();container.style.overflow="hidden";this.viewport.setScrollOffset({top:0,left:0});if(this.container==document.body&&Prototype.Browser.IE)
this.cssRule=CSS.addRule("html { overflow: hidden }");},resetOverflow:function(){var container=this.container;if(container.savedOverflow){if(this.container==document.body&&Prototype.Browser.IE)
this.cssRule.remove();container.style.overflow=container.savedOverflow;this.viewport.setScrollOffset(container.savedOffset);container.savedOffset=container.savedOverflow=null;}},hide:function(win){var previous=this.stack.getPreviousWindow(win);if(previous)previous.focus();},restartZIndexes:function(){var zIndex=this.getZIndex()+1;this.stack.windows.each(function(w){w.setZIndex(zIndex);zIndex=w.lastZIndex+1;});},getLastZIndex:function(){return this.stack.getFrontWindow().lastZIndex+1;},overlayStyle:"position: absolute; top: 0; left: 0; display: none; width: 100%;",createOverlays:function(){this.modalOverlay=new Element("div",{style:this.overlayStyle});this.dragOverlay=new Element("div",{style:this.overlayStyle+"height: 100%"});},focus:function(win){if(this.focusedWindow)
this.focusedWindow.blur();this.focusedWindow=win;},blur:function(win){if(win==this.focusedWindow)
this.focusedWindow=null;},setAltitude:function(win,altitude){var stack=this.stack;if(altitude==="front"){if(stack.getFrontWindow()===win)return;stack.bringToFront(win);}else if(altitude==="back"){if(stack.getBackWindow()===win)return;stack.sendToBack(win);}else{if(stack.getPosition(win)==altitude)return;stack.setPosition(win,altitude);}
this.restartZIndexes();return true;},getAltitude:function(win){return this.stack.getPosition(win);},resize:function(event){var area=this.viewport.getDimensions();if(this.maximizedWindow)
this.maximizedWindow.setSize(area.width,area.height);if(this.modalOverlay.visible())
this.modalOverlay.setStyle("height:"+area.height+"px");},handlePosition:function(win){if(Object.isNumber(win.options.top)&&Object.isNumber(win.options.left))
return;var strategy=this.options.positionningStrategy,area=this.viewport.getDimensions();Object.isFunction(strategy)?strategy(win,area):strategy.position(win,area);}});UI.WindowManager.DumbPositionningStrategy=function(win,area){size=win.getSize();var top=area.height-size.height,left=area.width-size.width;top=top<0?0:Math.random()*top;left=left<0?0:Math.random()*left;win.setPosition(top,left);};UI.WindowManager.optionsAccessor('zIndex','theme','shadowTheme');UI.WindowManager.Stack=Class.create(Enumerable,{initialize:function(){this.windows=[];},each:function(iterator){this.windows.each(iterator);},add:function(win,position){this.windows.splice(position||this.windows.length,0,win);},remove:function(win){this.windows=this.windows.without(win);},sendToBack:function(win){this.remove(win);this.windows.unshift(win);},bringToFront:function(win){this.remove(win);this.windows.push(win);},getPosition:function(win){return this.windows.indexOf(win);},setPosition:function(win,position){this.remove(win);this.windows.splice(position,0,win);},getFrontWindow:function(){return this.windows.last();},getBackWindow:function(){return this.windows.first();},getPreviousWindow:function(win){return(win==this.windows.first())?null:this.windows[this.windows.indexOf(win)-1];}});document.whenReady(function(){UI.defaultWM=new UI.WindowManager();});