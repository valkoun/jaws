/* http://www.gnu.org/copyleft/lesser.html */ var UsersCallback={adduser:function(a){a[0].css=="notice-message"&&(getUsers(),stopAction());showResponse(a);hideWorkingNotification()},updateuser:function(a){a[0].css=="notice-message"&&getUsers();showResponse(a);hideWorkingNotification()},updatemyaccount:function(a){a[0].message.indexOf("URL")>-1?window.location.reload():showResponse(a);hideWorkingNotification()},deleteuser:function(a){a[0].css=="notice-message"&&(getUsers(),stopAction());showResponse(a);hideWorkingNotification()},addgroup:function(a){a[0].css== "notice-message"&&(getGroups(),stopAction());showResponse(a);hideWorkingNotification()},updategroup:function(a){a[0].css=="notice-message"&&getGroups();showResponse(a);hideWorkingNotification()},deletegroup:function(a){a[0].css=="notice-message"&&(getGroups(),stopAction());showResponse(a);hideWorkingNotification()},saveuseracl:function(a){showResponse(a);hideWorkingNotification()},savegroupacl:function(a){showResponse(a);hideWorkingNotification()},resetuseracl:function(a){a[0].css=="notice-message"&& manageUserACL();showResponse(a);hideWorkingNotification()},resetgroupacl:function(a){a[0].css=="notice-message"&&manageGroupACL();showResponse(a);hideWorkingNotification()},adduserstogroup:function(a){showResponse(a);hideWorkingNotification()},addusertogroup:function(a){if(a[0].css=="notice-message")location.href="index.php?user/login.html";showResponse(a);hideWorkingNotification()},saveadvancedoptions:function(a){showResponse(a);hideWorkingNotification()},savesettings:function(a){showResponse(a); hideWorkingNotification()},deleteembed:function(a){a[0].message=="User not logged in."?(showResponse(a),window.location.reload()):searchXML($("search").value);hideWorkingNotification()},newupdate:function(a){showResponse(a);hideWorkingNotification()}};function addUpdate(a){w=new UI.URLWindow({height:450,width:750,shadow:!0,theme:"simpleblue",url:a,minimize:!1,maximize:!1,close:"destroy",resizable:!0});w.show(!0).focus().center();w.setZIndex(2147483647)} function getSelectedAction(a){a=document.forms[a].elements.action;if(!a)return"";var b=a.length;if(b==void 0)return a.checked?a.value:"";for(var c=0;c<b;c++)if(a[c]&&a[c].checked)return a[c].value;return""}var ifrm=[]; function getQuickAddForm(a,b,c,d,g,e){showWorkingNotification(null);for(e||(e="");$("actions-list").firstChild;)$("actions-list").removeChild($("actions-list").firstChild);$("quick-form").style.display="";if($("add"))$("add").style.display="none";if(ifrm[prevGadget])ifrm[prevGadget].style.display="none";ifrm[a]?ifrm[a].style.display="":(ifrm[a]=document.createElement("IFRAME"),ifrm[a].setAttribute("id","quick_add_"+a),ifrm[a].setAttribute("name","quick_add_"+a),ifrm[a].setAttribute("src","index.php?gadget="+ a+"&action=account_GetQuickAddForm&method="+b+"&id="+c+"&linkid="+d+"&section_id="+g),ifrm[a].style.width="100%",ifrm[a].style.height="5000px",ifrm[a].style.borderWidth="0px",ifrm[a].setAttribute("frameborder","0"),ifrm[a].setAttribute("scrolling","no"),ifrm[a].setAttribute("allowtransparency","true"),ifrm[a].frameBorder="0",ifrm[a].scrolling="no",$("quick-form").appendChild(ifrm[a]));$("save").onclick=function(){window.frames["quick_add_"+a].saveQuickAdd("Comment",b,e,$("sharing").value,$("syndication").value)}; $("save").style.display="";hideWorkingNotification()} function selectGadget(a,b,c,d,g,e,i){e||(e="");i||(i=null);showWorkingNotification(null);for($("gadget").value=a;$("actions-list").firstChild;)$("actions-list").removeChild($("actions-list").firstChild);$(prevGadget)&&($(prevGadget).setAttribute("class","gadget-item"),$(prevGadget).setAttribute("className","gadget-item"));$(a)&&($(a).setAttribute("class","gadget-item gadget-selected"),$(a).setAttribute("className","gadget-item gadget-selected"));$("share").style.display="";$("quick-form").style.display= "none";$("quick_add_cancel")&&$("quick_add_cancel").parentNode.removeChild($("quick_add_cancel"));if($("add"))$("add").style.display=b.substring(0,6)=="Update"||b.substring(0,4)=="Edit"?"none":"";if($("save"))$("save").style.display=b.substring(0,6)=="Update"||b.substring(0,4)=="Edit"?"":"none";if(i!==null)i();else{var j=usersSync.getquickaddforms(a,!0);$("post-form").style.display="none";link_shown=show_link=!1;form_size=j.size();form_size>1&&(brlink=document.createElement("br"),$("actions-list").appendChild(brlink), plink=document.createElement("p"));j.each(function(b){if(b.method&&b.name)form_size>1?(nlink=document.createElement("a"),nlink.setAttribute("href","javascript:void(0);"),nlink.onclick=function(){getQuickAddForm(a,b.method,c,d,g,e)},nlink.appendChild(document.createTextNode("Add "+b.name)),plink.appendChild(document.createTextNode(String.fromCharCode(32,32,32))),plink.appendChild(nlink)):getQuickAddForm(a,b.method,c,d,g,e)});if(form_size>1)brlink2=document.createElement("br"),plink.appendChild(brlink2), plink.setAttribute("align","right"),plink.style.paddingRight="10px",plink.style.paddingBottom="10px",plink.style.textAlign="right",$("actions-list").appendChild(plink)}$("save").style.display="";prevGadget=a;prevMethod=b;prevId=c;prevLinkid=d;prevSectionid=g;prevCallback=e;prevCustom_function=i;hideWorkingNotification()}function searchUser(){getUsers()}function showAllUsers(a){showAll=a.checked;searchUser()} function getUsers(){showWorkingNotification();resetCombo($("users_combo"));var a=usersSync.getusers(showAll,null);if(a!=!1){var b=$("users_combo"),c=0;a.each(function(a){a=new Option(a.username,a.id);a.style.backgroundColor=c%2==0?evenColor:oddColor;b.options[b.options.length]=a;c++})}hideWorkingNotification()} function getGroups(){showWorkingNotification();resetCombo($("groups_combo"));var a=usersSync.getgroups();if(a){var b=$("groups_combo"),c=0;a.each(function(a){a=new Option(a.name,a.id);a.style.backgroundColor=c%2==0?evenColor:oddColor;b.options[b.options.length]=a;c++})}hideWorkingNotification()}function resetCombo(a){for(;a.options.length!=0;)a.options[0]=null} function saveUser(){showWorkingNotification();var a="",a="";if(currentAction=="AdvancedUserOptions")usersAsync.saveadvancedoptions(selectedUser,$("user_language").value,$("user_theme").value,$("user_editor").value,$("user_timezone").value);else{if($("pass1").value!=$("pass2").value)return alert(wrongPassword),hideWorkingNotification(),!1;if(jawsTrim($("username").value)==""||jawsTrim($("name").value)==""||jawsTrim($("email").value)=="")return alert(incompleteUserFields),hideWorkingNotification(), !1;$("exponent")?(setMaxDigits(128),a=new RSAPublicKey($("exponent").value,$("modulus").value,128),a=encryptedString(a,$("pass1").value)):a=$("pass1").value;if(selectedUser==null){if(jawsTrim($("pass1").value)=="")return alert(incompleteUserFields),hideWorkingNotification(),!1;usersAsync.adduser($("username").value,a,$("name").value,$("email").value,$("user_group").value,$("user_type").value,$("enabled").value)}else usersAsync.updateuser(selectedUser,$("username").value,a,$("name").value,$("email").value, $("user_type").value,$("enabled").value,$("website").value,$("company").value,$("address").value,$("address2").value,$("city").value,$("country").value,$("region").value,$("postal").value,$("phone").value,$("office").value,$("tollfree").value,$("fax").value,$("merchant_id").value,$("description").value,$("logo").value,$("notification").value,$("allow_comments").value,$("public_gadget").value,$("keywords").value,$("company_type").value)}hideWorkingNotification()} function saveGroup(){showWorkingNotification();if(currentAction=="ManageUserGroups")addUserstoGroup();else{if(jawsTrim($("group_name").value)=="")return alert(incompleteGroupFields),!1;selectedGroup==null?usersAsync.addgroup($("group_name").value):usersAsync.updategroup(selectedGroup,$("group_name").value)}hideWorkingNotification()} function saveACL(){showWorkingNotification();for(var a=$("work_area").getElementsByTagName("input"),b=[],c=0;c<a.length;c++)if(a[c].changed)b[a[c].value]=a[c].checked;usersAsync.saveuseracl(selectedUser,b);hideWorkingNotification()} function addUserstoGroup(){showWorkingNotification();for(var a=$("work_area").getElementsByTagName("input"),b=[],c=0,d=0;d<a.length;d++)if(a[d].name.indexOf("group_users")!=-1&&a[d].checked)b[c]=a[d].value,c++;usersAsync.adduserstogroup(selectedGroup,b);hideWorkingNotification()}function addUserToGroup(a,b){showWorkingNotification();usersAsync.addusertogroup(a,b)}function deleteUser(){showWorkingNotification();confirm(confirmUserDelete)&&usersAsync.deleteuser(selectedUser)} function deleteGroup(){showWorkingNotification();confirm(confirmGroupDelete)&&usersAsync.deletegroup(selectedGroup);hideWorkingNotification()}function saveGroupACL(){showWorkingNotification();for(var a=$("work_area").getElementsByTagName("input"),b=[],c=0;c<a.length;c++)if(a[c].changed)b[a[c].value]=a[c].checked;usersAsync.savegroupacl(selectedGroup,b);hideWorkingNotification()} function resetUserACL(){showWorkingNotification();confirm(confirmResetACL)&&usersAsync.resetuseracl(selectedUser);hideWorkingNotification()}function resetGroupACL(){showWorkingNotification();confirm(confirmResetACL)&&usersAsync.resetgroupacl(selectedGroup);hideWorkingNotification()} function addUser(a){showWorkingNotification();a||(a=!1);cacheForm=usersSync.getuserform(a);$("cancel_action").style.display="block";$("save_user").style.display="block";$("add_user").style.display="none";$("work_area").innerHTML=cacheForm;$("user_group").parentNode.style.display="none";$("right_menu").style.display="none";selectedUser=null;a=usersSync.getgroups();if(a!=null){for(;$("user_group").options.length!=0;)$("user_group").options[0]=null;var b=new Option;b.id="-";b.text="----";$("user_group").options[$("user_group").options.length]= b;var c=1;a.each(function(a){b=new Option;b.id=a.id;b.text=a.name;b.style.backgroundColor=c%2==0?evenColor:oddColor;$("user_group").options[$("user_group").options.length]=b;c++});$("user_group").parentNode.style.display="block"}currentAction="AddUser";hideWorkingNotification()} function addGroup(){showWorkingNotification();cacheForm=usersSync.getgroupform();$("cancel_action").style.display="block";$("save_group").style.display="block";$("add_group").style.display="none";$("work_area").innerHTML=cacheForm;$("right_menu").style.display="none";selectedGroup=null;currentAction="AddGroup";hideWorkingNotification()} function editUser(a){showWorkingNotification();if(a!=0){cacheForm=usersSync.getuserform();selectedUser==null&&(currentAction="EditUser",stopAction());$("cancel_action").style.display="block";$("save_user").style.display="block";$("manage_acl").style.display="block";$("delete_user").style.display="block";$("add_user").style.display="none";$("save_acl").style.display="none";$("reset_acl").style.display="none";$("work_area").innerHTML=cacheForm;$("user_group").parentNode.style.display="none";$("right_menu").style.display= "block";selectedUser=a;a=usersSync.getuser(selectedUser);$("user_avatar").src=a.image;$("username").value=a.username;$("name").value=a.name;$("email").value=a.email;$("userInfo_action").value="EditUser";if(a.website)$("website").value=a.website;if(a.company)$("company").value=a.company;if(a.address)$("address").value=a.address;if(a.address2)$("address2").value=a.address2;if(a.city)$("city").value=a.city;if(a.country)$("country").value=a.country;if(a.region)$("region").value=a.region;if(a.postal)$("postal").value= a.postal;if(a.phone)$("phone").value=a.phone;if(a.office)$("office").value=a.office;if(a.tollfree)$("tollfree").value=a.tollfree;if(a.fax)$("fax").value=a.fax;if(a.merchant_id)$("merchant_id").value=a.merchant_id;if(a.description)$("description").value=a.description;a.user_type==0?$("user_type").selectedIndex=0:a.user_type==1?$("user_type").options[0].value==0?$("user_type").selectedIndex=1:$("user_type").selectedIndex=0:$("user_type").selectedIndex=$("user_type").options.length-1;$("enabled").value= a.enabled;currentAction="EditUser";hideWorkingNotification()}} function editGroup(a){showWorkingNotification();if(a!=0)cacheForm=usersSync.getgroupform(),$("cancel_action").style.display="block",$("save_group").style.display="block",$("manage_acl").style.display="block",$("add_usergroups").style.display="block",$("delete_group").style.display="block",$("add_group").style.display="none",$("save_acl").style.display="none",$("reset_acl").style.display="none",$("work_area").innerHTML=cacheForm,$("right_menu").style.display="block",selectedGroup=a,currentAction="EditGroup", a=usersSync.getgroup(selectedGroup),$("group_name").value=a.name,hideWorkingNotification()} function minPane(a,b){showWorkingNotification();currentAction="MinimizePane";var c=usersSync.updateusersgadgets(b,a,"minimized");if(c[0].css=="notice-message"){if($(a+"_pane"))$(a+"_pane").style.display="none";if($(a+"_button1"))$(a+"_button1").innerHTML='<img border="0" src="images/btn_paneMax_on.png" name="Expand" alt="Expand" title="Expand" onClick="maxPane(\''+a+"', "+b+');" onMouseover="this.src=\'images/btn_paneMax_off.png\'" onMouseOut="this.src=\'images/btn_paneMax_on.png\'" />';else if($(a+ "_button2"))$(a+"_button2").innerHTML='<img border="0" src="images/btn_paneMax_on.png" name="Expand" alt="Expand" title="Expand" onClick="maxPane(\''+a+"', "+b+');" onMouseover="this.src=\'images/btn_paneMax_off.png\'" onMouseOut="this.src=\'images/btn_paneMax_on.png\'" />';stopAction()}else c[0].message=="User not logged in."?(showResponse(c),window.location.reload()):showResponse(c);hideWorkingNotification()} function maxPane(a,b){showWorkingNotification();currentAction="MaximizePane";var c=usersSync.updateusersgadgets(b,a,"maximized");if(c[0].css=="notice-message"){if($(a+"_pane"))$(a+"_pane").style.display="inline";if($(a+"_button2"))$(a+"_button2").innerHTML='<img border="0" src="images/btn_paneMin_on.png" name="Collapse" alt="Collapse" title="Collapse" onClick="minPane(\''+a+"', "+b+');" onMouseover="this.src=\'images/btn_paneMin_off.png\'" onMouseOut="this.src=\'images/btn_paneMin_on.png\'" />';else if($(a+ "_button1"))$(a+"_button1").innerHTML='<img border="0" src="images/btn_paneMin_on.png" name="Collapse" alt="Collapse" title="Collapse" onClick="minPane(\''+a+"', "+b+');" onMouseover="this.src=\'images/btn_paneMin_off.png\'" onMouseOut="this.src=\'images/btn_paneMin_on.png\'" />';stopAction()}else c[0].message=="User not logged in."?(showResponse(c),window.location.reload()):showResponse(c);hideWorkingNotification()} function deleteSubscription(a,b){currentAction="DeleteSubscription";if(eval("confirm"+a+"Delete")&&confirm(eval("confirm"+a+"Delete"))){showWorkingNotification();var c=usersSync.deletesubscription(a,b);c[0].css=="notice-message"?($(a+"_syntactsCategory_"+b).style.display="none",stopAction()):c[0].message=="User not logged in."&&(showResponse(c),window.location.reload());hideWorkingNotification();showResponse(c)}}function deleteEmbed(a,b){confirm(confirmEmbedDelete)&&usersAsync.deleteembed(a,b)} function searchXML(a,b){for(;$("actions-list").firstChild;)$("actions-list").removeChild($("actions-list").firstChild);if($("gadget").value){showWorkingNotification();var c=null;usersSync.getgadgetactions($("gadget").value,a,b).each(function(a){a.message=="User not logged in."&&parent.parent.window.location.reload();c==null&&(c=a.id);li=document.createElement("li");r=createNamedElement("input","action");r.setAttribute("type","radio");r.setAttribute("value",a.url);r.setAttribute("id",a.id);r.checked= a.checked;label=document.createElement("label");label.setAttribute("for",a.id);a.checked==!0?(label.innerHTML=a.name+'<br /><span style="display: inline;">'+a.url+"</span>&nbsp;",aea=document.createElement("a"),aea.setAttribute("href","javascript:void(0);"),aea.onclick=function(){deleteEmbed(a.url,b)},aea.setAttribute("id","a_"+a.id),aea.setAttribute("name","a_"+a.name),aea.setAttribute("title","Un-Embed Gadget on this URL"),aea.appendChild(document.createTextNode("Un-embed")),label.appendChild(aea)): label.innerHTML=a.name+"<span>"+a.url+"</span>";li.appendChild(r);li.appendChild(label);$("actions-list").appendChild(li)});c==null?(li=document.createElement("li"),li.setAttribute("class","action-msg"),li.setAttribute("className","action-msg"),li.appendChild(document.createTextNode(noActionsMsg)),$("actions-list").appendChild(li)):$(c).checked=!0;hideWorkingNotification()}} function createNamedElement(a,b){var c=null;try{c=document.createElement("<"+a+' name="'+b+'">')}catch(d){}if(!c||c.nodeName!=a.toUpperCase())c=document.createElement(a),c.name=b;return c} function selectSite(a){for(;$("actions-list").firstChild;)$("actions-list").removeChild($("actions-list").firstChild);a=="manual"?($("search-entry").style.display="none",$("gadget-actions").style.display="none",$("layout").style.display="none",$("add").style.display="none",$("embed-manual").style.display="block"):($("embed-manual").style.display="none",$("search-entry").style.display="block",$("gadget-actions").style.display="block",$("add").style.display="",$("layout").style.display="block",$("gadget").value= a);$(prevSite)&&prevSite!=a&&($(prevSite).setAttribute("class","gadget-item"),$(prevSite).setAttribute("className","gadget-item"));$(a).setAttribute("class","gadget-item gadget-selected");$(a).setAttribute("className","gadget-item gadget-selected");prevSite=a} function selectPane(a){if($(a)){showWorkingNotification();if($("pane-content")){if($(prevPane)){if($("pane-"+prevPane))$("pane-"+prevPane).style.display="none";$(prevPane).setAttribute("class","pane-item");$(prevPane).setAttribute("className","pane-item")}else if($("Updates")){if($("pane-Updates"))$("pane-Updates").style.display="none";$("Updates").setAttribute("class","pane-item");$("Updates").setAttribute("className","pane-item")}$(a).setAttribute("class","pane-item pane-selected");$(a).setAttribute("className", "pane-item pane-selected");$("pane-"+a).style.display="inline";prevPane=a;location.hash="#pane="+prevPane;a="";for(f=0;f<document.forms.length;f++)a=document.forms[f].action+"",a=document.forms[f].action!=""?a.substring(0,a.indexOf("#"))+location.hash:window.location,document.forms[f].setAttribute("action",a)}hideWorkingNotification()}} function selectLetter(a){$("letter-"+a)&&(showWorkingNotification(),$("letter-"+a).setAttribute("class","letter letter-selected"),$("letter-"+a).setAttribute("className","letter letter-selected"),hideWorkingNotification())} function addFileToPost(a,b,c,d,g,e,i,j,k,p,l,m){p||(p=!1);i||(i=750);j||(j=34);l||(l="");m||(m="");if($(d+"_no_items"))$(d+"_no_items").style.display="none";var d=$(d),k=d.getElementsByTagName("tbody"),s=new Date,q=0;is_table=!1;k[0]&&(is_table=!0,d.getElementsByTagName("tr"));for(n=0;n<e;n++){q=s.getTime();if(is_table){var h=document.createElement("tr");h.setAttribute("width","100%");h.setAttribute("noDrag","true");h.setAttribute("noDrop","true")}else h=document.createElement("div");h.setAttribute("id", "syntactsCategory_"+q);if(is_table){var o=h.appendChild(document.createElement("td"));o.setAttribute("class","syntacts-form-row");o.setAttribute("className","syntacts-form-row")}ifrm=document.createElement("IFRAME");ifrm.setAttribute("id","iframe_"+(fileCount+1));e>1?ifrm.setAttribute("src",l+"index.php?gadget=FileBrowser&action=account_AddFileToPost&linkid="+g+"&table="+b+"&method="+c+"&addtogadget="+a+"&n="+(fileCount+1)+"&bc="+h.style.backgroundColor+"&types="+m):ifrm.setAttribute("src",l+"index.php?gadget=FileBrowser&action=account_AddFileToPost&where="+ g+"&table="+b+"&method="+c+"&addtogadget="+a+"&n="+(fileCount+1)+"&bc="+h.style.backgroundColor+"&types="+m);ifrm.style.width=i+"px";ifrm.style.height=j+"px";ifrm.style.borderWidth="0px";ifrm.setAttribute("frameborder","0");ifrm.setAttribute("scrolling","no");ifrm.setAttribute("allowtransparency","true");ifrm.frameBorder="0";ifrm.scrolling="no";if(n==0&&is_table)o.innerHTML='<a name="newImages'+fileCount+'">&nbsp;</a>';is_table?(o.appendChild(ifrm),k[0].appendChild(h)):(h.appendChild(ifrm),d.appendChild(h)); Effect.Appear(h.id,{duration:1});fileCount++}d.setAttribute("width","100%");if(is_table)k[0].style.display="block";nextFiles=fileCount-5;nextFiles<0&&(nextFiles=0);if(e>1&&p===!0)docLocation=document.location+"",location.href=docLocation.indexOf("#newImages")>-1?docLocation.substr(0,docLocation.indexOf("#newImages"))+"#newImages"+nextFiles:docLocation+"#newImages"+nextFiles} function commentSharing(){for(;$("actions-list").firstChild;)$("actions-list").removeChild($("actions-list").firstChild);$("share").style.display="none";$("post-form").style.display="none";$("quick-form").style.display="";if($("add"))$("add").style.display="none";if(ifrm[prevGadget])ifrm[prevGadget].style.display="none";ifrm.Sharing?ifrm.Sharing.style.display="":(ifrm.Sharing=document.createElement("IFRAME"),ifrm.Sharing.setAttribute("id","quick_add_Sharing"),ifrm.Sharing.setAttribute("name","quick_add_Sharing"), ifrm.Sharing.setAttribute("src","index.php?gadget=Users&action=account_ShareComment"),ifrm.Sharing.style.width="100%",ifrm.Sharing.style.height="5000px",ifrm.Sharing.style.borderWidth="0px",ifrm.Sharing.setAttribute("frameborder","0"),ifrm.Sharing.setAttribute("scrolling","no"),ifrm.Sharing.setAttribute("allowtransparency","true"),ifrm.Sharing.frameBorder="0",ifrm.Sharing.scrolling="no",$("quick-form").appendChild(ifrm.Sharing));$("save").onclick=function(){window.frames.quick_add_Sharing.saveCommentSharing()}; $("save").style.display=""} function setCommentSharing(a){$("share-user")&&$("share-user").parentNode.removeChild($("share-user"));$("share-syndication")&&$("share-syndication").parentNode.removeChild($("share-syndication"));$("share-button")&&$("share-button").parentNode.removeChild($("share-button"));parent.showWorkingNotification();if(a=="specific"){shareCounter=0;a=document.createElement("DIV");a.setAttribute("id","share-user");a.style.paddingTop="5px";a.style.paddingLeft="45px";a.style.height="160px";a.style.maxHeight= "160px";a.style.overflow="auto";$("gadget-list").appendChild(a);parent.$("sharing").value="users:";var b=[];userList===null&&(userList=usersSync.getfriendsofuser());if(userList)b.Users=[],userList.each(function(a){b.Users[shareCounter]=[];b.Users[shareCounter].desc=a.realname;b.Users[shareCounter].value=!1;b.Users[shareCounter].name="share_user_"+a.id;shareCounter++});a=usersSync.getgroupsofuser();if(a!=!1)b.Groups=[],a.each(function(a){b.Groups[shareCounter]=[];b.Groups[shareCounter].desc=a.name; b.Groups[shareCounter].value=!1;b.Groups[shareCounter].name="share_group_"+a.id;shareCounter++});$("share-user").innerHTML=convertToTree(b)}else parent.$("sharing").value=a;parent.hideWorkingNotification();return!1} function addShareEmail(a){var b=document.createElement("INPUT");b.setAttribute("name","add_email_"+emailCounter);b.setAttribute("value","Add Another E-mail");b.defaultValue="Add Another E-mail";b.onfocus=function(){if(this.defaultValue==this.value)this.value="",this.style.color="#000000";else if(this.value=="")this.value=this.defaultValue,this.style.color="#999999"};b.onblur=function(){if(this.defaultValue==this.value)this.value="",this.style.color="#000000";else if(this.value=="")this.value=this.defaultValue, this.style.color="#999999"};b.style.color="#999999";b.style.minWidth="180px";b.style.marginLeft="5px";emailCounter++;b.onclick=function(){new_input=addShareEmail(a);$(a).appendChild(new_input)};return b} function saveCommentSharing(){parent.showWorkingNotification();if(!(parent.$("sharing").value=="everyone"||parent.$("sharing").value=="friends")&&parent.$("sharing").value!="friends"){parent.$("sharing").value="users:";for(var a=$("share-user").getElementsByTagName("input"),b=shareCounter=0;b<a.length;b++)if(a[b].value.indexOf("share_user")>=0)a[b].checked&&(parent.$("sharing").value+=shareCounter>0?","+a[b].value.replace("share_user_",""):a[b].value.replace("share_user_",""),shareCounter++);else if(a[b].value.indexOf("share_group")>= 0&&a[b].checked){var c=usersSync.getusersofgroup(a[b].value.replace("share_group_",""));c!=!1&&c.each(function(a){parent.$("sharing").value+=shareCounter>0?","+a.user_id:a.user_id});shareCounter++}}parent.selectGadget(parent.prevGadget,parent.prevMethod,parent.prevId,parent.prevLinkid,parent.prevSectionid,parent.prevCallback,parent.prevCustom_function);parent.$("share").style.display="";parent.hideWorkingNotification();return!1} function toggleFullMerchantDescription(){$("merchant-desc-full")&&(w1=new UI.Window({theme:"simpleblue",height:350,width:600,shadow:!0,minimize:!1,maximize:!1,close:"destroy",resizable:!1,draggable:!0}),w1.setContent('<div style="text-align: left; padding: 20px;" class="merchant-description">'+$("merchant-desc-full").innerHTML+"</div>"),w1.setZIndex(2147483647),w1.show().focus(),w1.center())} function toggleFullUpdate(a){if($("news-preview-"+a))$("news-preview-"+a).style.display=="none"?$("news-preview-"+a).style.display="block":$("news-preview-"+a).style.display="none";if($("news-full-"+a))$("news-full-"+a).style.display=="none"?$("news-full-"+a).style.display="block":$("news-full-"+a).style.display="none"}function showUpdateForm(){$("update-holder").style.display="none";$("update-buttons").style.display="block";$("update-area").style.display="block";$("update-entry").focus()} function hideUpdateForm(){$("update-holder").style.display="block";$("update-buttons").style.display="none";$("update-area").style.display="none";$("update-entry").value=""} function saveUpdate(a,b,c,d,g,e){b||(b="");c||(c="");d||(d=0);g||(g="everyone");e||(e=!1);if(b.length<=0&&$("update-entry")&&$("update-entry").value.length>0)b=$("update-entry").value,$("update-entry").value="";response=usersSync.newcomment(c,b,d,a,"",!1,g,e);response.css=="notice-message"?(news_items_html='<div class="news-item news-message" id="news-'+response.id+'" onmouseout="if ($(\'news-delete-'+response.id+"')){$('news-delete-"+response.id+"').style.visibility = 'hidden';};\" onmouseover=\"if ($('news-delete-"+ response.id+"')){$('news-delete-"+response.id+"').style.visibility = 'visible';};\">",news_items_html+='\t<div class="news-delete" id="news-delete-'+response.id+'"><a href="javascript:void(0);" onclick="DeleteComment('+response.id+", 'update');\">X</a></div>",news_items_html+='\t<div class="news-image">'+response.image+"</div>",news_items_html+='\t<div class="news-body">',news_items_html+='\t\t<div class="news-title">'+response.title+"</div>",news_items_html+='\t\t<div class="news-info"><span class="news-name">'+ (response.link!=""?'<a href="'+response.link+'">':"")+response.name+(response.link!=""?"</a>":"")+"</span>&nbsp;",news_items_html+='\t\t<div class="news-preview" id="news-preview-'+response.id+'"'+response.preview_style+">"+response.preview_comment+"</div>",news_items_html+='\t\t<div class="news-message" id="news-full-'+response.id+'"'+response.full_style+">"+response.comment+"</div></div>",news_items_html+='\t\t<div class="news-created news-timestamp">'+response.created+response.activity+"</div>", news_items_html+='\t\t<div class="news-comments" id="news-comments-'+response.id+'">',news_items_html+="\t\t</div>",news_items_html+='\t\t<div class="comments-form">',news_items_html+='\t\t\t<div class="comment-holder" id="comment-holder-'+response.id+'">',news_items_html+='\t\t\t<input class="comment-click" id="comment-click-'+response.id+'" value="Reply to this..." onclick="showCommentForm('+response.id+');" />',news_items_html+="\t\t\t</div>",news_items_html+='\t\t\t<div class="comment-area" id="comment-area-'+ response.id+'">',news_items_html+='\t\t\t<textarea class="comment-entry" id="comment-entry-'+response.id+"\" onblur=\"if (this.value == '') {hideCommentForm("+response.id+');};"></textarea>',news_items_html+="\t\t\t</div>",news_items_html+='\t\t\t<div class="comment-buttons" id="comment-buttons-'+response.id+'"><button type="button" name="commentButton'+response.id+'" id="commentButton-'+response.id+'" value="Ok" style="min-width: 60px;" onclick="javascript: saveReply('+response.id+');">Ok</button></div>', news_items_html+="\t\t</div>",news_items_html+="\t</div>",news_items_html+="</div>",$("news-items").innerHTML=news_items_html+$("news-items").innerHTML,e===!0&&RPXNOW.loadAndRun(["Social"],function(){var a="posted on "+window.location.hostname.charAt(0).toUpperCase()+window.location.hostname.substring(1,window.location.hostname.length);response.comment!=""&&(a='posted "'+response.comment+'"');a=new RPXNOW.Social.Activity("Share this",a,response.permalink);response.title!=""?a.setTitle(response.title): a.setTitle(window.location.hostname.charAt(0).toUpperCase()+window.location.hostname.substring(1,window.location.hostname.length));RPXNOW.Social.publishActivity(a)})):(error=[[]],error[0].css=response.css,error[0].message=response.message,showResponse(error));$("shareButton")&&window.location.reload()} function saveStatus(a,b,c,d,g,e){b||(b="");c||(c="");d||(d=0);g||(g="everyone");e||(e=!1);if(b.length<=0&&$("update-entry")&&$("update-entry").value.length>0)b=$("update-entry").value,$("update-entry").value="";response=usersSync.newstatus(c,b,d,a,"",!1,g);response.css=="notice-message"?(news_items_html='<div class="news-item news-message" id="news-'+response.id+'" onmouseout="if ($(\'news-delete-'+response.id+"')){$('news-delete-"+response.id+"').style.visibility = 'hidden';};\" onmouseover=\"if ($('news-delete-"+ response.id+"')){$('news-delete-"+response.id+"').style.visibility = 'visible';};\">",news_items_html+='\t<div class="news-delete" id="news-delete-'+response.id+'"><a href="javascript:void(0);" onclick="DeleteComment('+response.id+", 'update');\">X</a></div>",news_items_html+='\t<div class="news-image">'+response.image+"</div>",news_items_html+='\t<div class="news-body">',news_items_html+='\t\t<div class="news-title">'+response.title+"</div>",news_items_html+='\t\t<div class="news-info"><span class="news-name">'+ (response.link!=""?'<a href="'+response.link+'">':"")+response.name+(response.link!=""?"</a>":"")+"</span>&nbsp;",news_items_html+='\t\t<span class="news-preview" id="news-preview-'+response.id+'"'+response.preview_style+">"+response.preview_comment+'</span><span class="news-message" id="news-full-'+response.id+'"'+response.full_style+">"+response.comment+"</span></div>",news_items_html+='\t\t<div class="news-created news-timestamp">'+response.created+response.activity+"</div>",news_items_html+='\t\t<div class="news-comments" id="news-comments-'+ response.id+'">',news_items_html+="\t\t</div>",news_items_html+='\t\t<div class="comments-form">',news_items_html+='\t\t\t<div class="comment-holder" id="comment-holder-'+response.id+'">',news_items_html+='\t\t\t<input class="comment-click" id="comment-click-'+response.id+'" value="Reply to this..." onclick="showCommentForm('+response.id+');" />',news_items_html+="\t\t\t</div>",news_items_html+='\t\t\t<div class="comment-area" id="comment-area-'+response.id+'">',news_items_html+='\t\t\t<textarea class="comment-entry" id="comment-entry-'+ response.id+"\" onblur=\"if (this.value == '') {hideCommentForm("+response.id+');};"></textarea>',news_items_html+="\t\t\t</div>",news_items_html+='\t\t\t<div class="comment-buttons" id="comment-buttons-'+response.id+'"><button type="button" name="commentButton'+response.id+'" id="commentButton-'+response.id+'" value="Ok" style="min-width: 60px;" onclick="javascript: saveReply('+response.id+');">Ok</button></div>',news_items_html+="\t\t</div>",news_items_html+="\t</div>",news_items_html+="</div>", $("news-items").innerHTML=news_items_html+$("news-items").innerHTML,e===!0&&RPXNOW.loadAndRun(["Social"],function(){var a="posted on "+window.location.hostname.charAt(0).toUpperCase()+window.location.hostname.substring(1,window.location.hostname.length);response.comment!=""&&(a='posted "'+response.comment+'"');a=new RPXNOW.Social.Activity("Share this",a,response.permalink);response.title!=""?a.setTitle(response.title):a.setTitle(window.location.hostname.charAt(0).toUpperCase()+window.location.hostname.substring(1, window.location.hostname.length));RPXNOW.Social.publishActivity(a)})):(error=[[]],error[0].css=response.css,error[0].message=response.message,showResponse(error))}function toggleAllComments(a){$$(".comment-hidden-"+a).each(function(a){a.style.display="block"});if($("all-comments-"+a))$("all-comments-"+a).style.display="none"} function toggleFullComment(a){if($("comment-preview-"+a))$("comment-preview-"+a).style.display=="none"?$("comment-preview-"+a).style.display="inline":$("comment-preview-"+a).style.display="none";if($("comment-full-"+a))$("comment-full-"+a).style.display=="none"?$("comment-full-"+a).style.display="inline":$("comment-full-"+a).style.display="none"} function showCommentForm(a){if($("comment-holder-"+a))$("comment-holder-"+a).style.display="none";if($("comment-area-"+a))$("comment-area-"+a).style.display="block";if($("comment-buttons-"+a))$("comment-buttons-"+a).style.display="block";$("comment-entry-"+a)&&$("comment-entry-"+a).focus();$("comment-entry-"+a).onBlur=function(){hideCommentForm()}} function hideCommentForm(a){if($("comment-holder-"+a))$("comment-holder-"+a).style.display="block";if($("comment-area-"+a))$("comment-area-"+a).style.display="none";if($("comment-buttons-"+a))$("comment-buttons-"+a).style.display="none";if($("comment-entry-"+a))$("comment-entry-"+a).value=""} function saveReply(a,b){if($("comment-entry-"+a)&&$("comment-entry-"+a).value.length>0)comment=$("comment-entry-"+a).value,$("comment-entry-"+a).value="";response=usersSync.newcomment("",comment,a,b,"",!1);response.css=="notice-message"?(news_comments_html='<div class="comment comment-new" id="comment-'+response.id+'" onmouseout="if ($(\'comment-delete-'+response.id+"')){$('comment-delete-"+response.id+"').style.visibility = 'hidden';};\" onmouseover=\"if ($('comment-delete-"+response.id+"')){$('comment-delete-"+ response.id+"').style.visibility = 'visible';};\">",news_comments_html+='<div id="comment-delete-'+response.id+'" class="comment-delete"><a onclick="DeleteComment('+response.id+', \'reply\');" href="javascript:void(0);">X</a></div>',news_comments_html+=response.image+'<div class="comment-body"><span class="comment-name">'+(response.link!=""?'<a href="'+response.link+'" class="comment-name">':"")+response.name+(response.link!=""?"</a>":"")+'</span>&nbsp;<span class="comment-preview" id="comment-preview-'+ response.id+'"'+response.preview_style+">"+response.preview_comment+'</span><span class="comment-message" id="comment-full-'+response.id+'"'+response.full_style+">"+response.comment+"</span>",news_comments_html+='</div><div class="comment-created news-timestamp">'+response.created+"</div>",news_comments_html+="</div>",$("news-comments-"+a).innerHTML=$("news-comments-"+a).innerHTML+news_comments_html):(error=[[]],error[0].css=response.css,error[0].message=response.message,showResponse(error));hideCommentForm(a); if($("all-comments-"+a))$("all-comments-"+a).innerHTML='<a href="javascript:void(0);" onclick="toggleAllComments('+response.id+');">View all comments</a>'}function DeleteComment(a,b){b||(b="update");confirm(confirmCommentDelete)&&usersSync.deletecomment(a)[0].css=="notice-message"&&(b=="update"&&$("news-"+a)?$("news-"+a).parentNode.removeChild($("news-"+a)):b=="reply"&&$("comment-"+a)&&$("comment-"+a).parentNode.removeChild($("comment-"+a)))} function stopAction(){switch(currentAction){case "EditUser":case "AddUser":$("add_user").style.display="block";$("save_user").style.display="none";$("manage_acl").style.display="none";$("save_acl").style.display="none";$("reset_acl").style.display="none";$("delete_user").style.display="none";$("users_combo").selectedIndex=-1;$("work_area").innerHTML="";$("cancel_action").style.display="none";$("right_menu").style.display="none";selectedUser=null;break;case "ManageUserACL":case "AdvancedUserOptions":$("save_acl").style.display= "none";$("reset_acl").style.display="none";$("save_user").style.display="block";editUser(selectedUser);break;case "EditGroup":case "AddGroup":$("add_group").style.display="block";$("save_group").style.display="none";$("manage_acl").style.display="none";$("save_acl").style.display="none";$("reset_acl").style.display="none";$("delete_group").style.display="none";$("groups_combo").selectedIndex=-1;$("work_area").innerHTML="";$("cancel_action").style.display="none";$("add_usergroups").style.display="none"; $("right_menu").style.display="none";selectedGroup=null;break;case "ManageGroupACL":case "ManageUserGroups":$("save_acl").style.display="none",$("reset_acl").style.display="none",$("save_group").style.display="block",editGroup(selectedGroup)}} function convertToTree(a){tree=new WebFXTree(permissionsMsg);if(typeof jaws_url=="undefined"||!jaws_url)jaws_url="";tree.openIcon=jaws_url+"images/blank.gif";for(gadget in a)if(typeof a[gadget]!="function"){var b=new WebFXTreeItem(gadget);for(aclKey in a[gadget])if(a[gadget][aclKey].desc!=void 0){var c=document.createElement("div"),d=document.createElement("input");d.setAttribute("type","checkbox");d.setAttribute("name","acls[]");d.setAttribute("value",a[gadget][aclKey].name);if(a[gadget][aclKey].value== !0)d.defaultChecked=!0,d.setAttribute("checked",!0);d.setAttribute("id",a[gadget][aclKey].name);d.setAttribute("changed",!1);d.setAttribute("onclick","javascript: this.changed = true;");d.onclick=function(){this.changed=!0};var g=document.createElement("label");g.htmlFor=a[gadget][aclKey].name;g.appendChild(document.createTextNode(a[gadget][aclKey].desc));c.appendChild(d);c.appendChild(g);c=new WebFXTreeItem(c.innerHTML);b.add(c)}tree.add(b)}return tree.toString()} function advancedUserOptions(){showWorkingNotification();var a=usersSync.getadvuseroptionsui(selectedUser);$("work_area").innerHTML=a;$("save_user").style.display="block";$("save_acl").style.display="none";$("reset_acl").style.display="none";$("manage_acl").style.display="none";$("delete_user").style.display="none";$("right_menu").style.display="none";currentAction="AdvancedUserOptions";hideWorkingNotification()} function manageUserACL(){showWorkingNotification();var a=usersSync.getuseraclkeys(selectedUser);$("work_area").innerHTML=convertToTree(a);$("save_user").style.display="none";$("save_acl").style.display="block";$("reset_acl").style.display="block";$("manage_acl").style.display="none";$("delete_user").style.display="none";$("right_menu").style.display="none";currentAction="ManageUserACL";hideWorkingNotification()} function manageGroupACL(){showWorkingNotification();var a=usersSync.getgroupaclkeys(selectedGroup);$("work_area").innerHTML=convertToTree(a);$("save_group").style.display="none";$("save_acl").style.display="block";$("reset_acl").style.display="block";$("manage_acl").style.display="none";$("add_usergroups").style.display="none";$("delete_group").style.display="none";$("right_menu").style.display="none";currentAction="ManageGroupACL";hideWorkingNotification()} function addUsersToGroup(){showWorkingNotification();$("work_area").innerHTML=usersSync.getusergroupsform(selectedGroup);$("save_group").style.display="block";$("save_acl").style.display="none";$("reset_acl").style.display="none";$("manage_acl").style.display="none";$("add_usergroups").style.display="none";$("delete_group").style.display="none";$("right_menu").style.display="none";currentAction="ManageUserGroups";hideWorkingNotification()} function saveSettings(){showWorkingNotification();var a=$("priority").value,b=$("auth_method").value,c=$("anon_register").value,d=$("password_recovery").value;usersAsync.savesettings(a,b,c,d);hideWorkingNotification()} function updateMyAccount(){showWorkingNotification();if($("pass1").value!=$("pass2").value)return alert(wrongPassword),!1;if(jawsTrim($("username").value)==""||jawsTrim($("name").value)==""||jawsTrim($("email").value)=="")return alert(incompleteUserFields),!1;if($("exponent")){setMaxDigits(128);var a=new RSAPublicKey($("exponent").value,$("modulus").value,128),a=encryptedString(a,$("pass1").value)}else a=$("pass1").value;usersAsync.updatemyaccount($("id").value,$("username").value,a,$("name").value, $("email").value,$("website").value,$("company").value,$("address").value,$("address2").value,$("city").value,$("country").value,$("region").value,$("postal").value,$("phone").value,$("office").value,$("tollfree").value,$("fax").value,$("merchant_id").value,$("description").value);hideWorkingNotification()}var usersAsync=new usersajax(UsersCallback);usersAsync.serverErrorFunc=Jaws_Ajax_ServerError;var usersSync=new usersajax;usersSync.serverErrorFunc=Jaws_Ajax_ServerError; var selectedUser=null,selectedGroup=null,showAll=!1,evenColor="#fff",oddColor="#edf3fe",cacheForm=null,cacheUserGroupForm=null,currentAction=null,xtreeLoaded=!1,xtree=null,shareCounter=0,emailCounter=0,fileCount=0,prevSite="",prevGadget="",prevMethod="",prevId="",prevLinkid="",prevSectionid="",prevCallback="",prevCustom_function="",prevPane="",userList=null;